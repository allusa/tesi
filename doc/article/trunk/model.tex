\section{Preliminaries}

A \emph{measure} is a tuple $(v,t)$ where $v\in{\mathbb{R}}$ is the
value of the measure and $t \in \mathbb{R}$ is the instant in time of
measurement. Let $m = (v,t)$ be a measure, $v$ is written as $V(m)$
and $t$ is written as $T(m)$.

The time value defines the order between measures.  Let $m = (v_m,
t_m)$ and $n = (v_n, t_n)$ be two measures, then $m\geq n$ if and only
if $t_m\geq t_n$.

A time series is sequence of measures that are ordered in time. 
\begin{definition}[Time series]
  A \emph{time series} $S$ is a a set of measures $S = \{m_0, \ldots,
  m_k\}$ without repeated time values $\forall i,j: i\leq k, j\leq k,
  i\neq j : T(m_i)\neq T(m_j)$, where $k+1=|S|$ is the cardinality of
  the set.
\end{definition}

The order defined by measures implies a total order in a time
series. As a time series is a finite set, if it is not empty it has a
maximum and a minimum.  Let $S=\{m_0,\ldots,m_k\}$ be a time series
and $n\in S$ be a measure. The time series' maximum is $n=\max(S)$ if
and only if $\forall m \in S: n \geq m $.  Similarly, the time series'
minimum is $n=\min(S)$ if and only if $\forall m \in S: n \leq m$.

Given the order defined by time, in a time series we define the
sequence interval similarly as it is done in
\cite{last:keogh,last:hetland}.  Let $S=\{m_0, \ldots, m_k\}$ be a
time series. We define the subset $S(r,t] \subseteq S$ as the time
series $S(r,t]=\{m\in S | r<T(m)\leq t\}$, where $r$ and $t$ are two
instants in time.  We also define the subset $S(r,+\infty)\subseteq S$
as the time series $S(r,+\infty) = \{m\in S | r< T(m) \leq
T(\max(S))\}$ and the subset $S(-\infty,t)\subseteq S$ as the time
series $S(-\infty,t) = \{m\in S | T(\min(S))\leq T(m) < t\}$.


The time order in time series also implies the sequence concept of
next and previous measure.  Let $S=\{m_0, \ldots, m_k\}$ be a time
series and $l\in S$ and $n$ be two measures. We define the next
measure of $n$ in $S$ as $l=\nex_S(n)$ where $l =
\min(S(T(n),+\infty))$. We define the previous measure of $n$ in $S$
as $l=\prev_S(n)$ where $l = \max(S(-\infty,T(n)))$.


%\subsubsection{Regularity of time series}

Let $S=\{m_0,\ldots,m_k\}$ be a time series, $t$ an time instant and
$\delta$ a time duration, the time series' measures can be located in
the time interval $i_0=[t,t+\delta]$ and its multiples $i_j=[t+j\delta
\,,\, t+(j+1)\delta]: j=0,1,2,\ldots$. In signal processing, these
time intervals are called sampling intervals, $\delta$ is called
sampling period and $t$ is called initial time. When the measures are
equally spaced the time series is called regular.

\begin{definition}[Regular time series]
  Let $S=\{m_0,\ldots,m_k\}$ be a time series and $\delta$ a time
  duration. $S$ is regular if and only if $\forall m \in
  S(T(\min(S),+\infty):T(m) - T(\prev_S(m)) =
  \delta$. %Property: for a regular time series there is a initial
           %time instant, let $t_0$ be a time instant then $T(\min(S))=t_0$.
\end{definition}



\section{The multiresolution TSMS data model}
\label{sec:MTSMS}

In this section we design a mathematical model for the multiresolution
time series database management systems (MTSMS). Some concepts come
from an abstraction of RRDtool operations \cite{rrdtool}.

A MTSMS manages time series. A time series is regarded as a
chronological data collection, so it needs an appropriate management
by the DBMS.  The MTSMS model is an storage solution for a time series
where, in short, the time series information is spread in different
time resolutions.

The main objects of a MTSMS are \emph{measures} and \emph{time
  series}. A \emph{measure} is a value measured in an instant in time
and a \emph{time series} is a collection of \emph{measures}. A
database from a MTSMS contains one time series, which internally is
stored in multiple resolutions of itself.

\begin{figure}[tp]
\centering
\setlength{\unitlength}{0.3mm}
\input{\imatges/model/locales/mtsdb-internal_architecture.tex}
\caption{Architecture of MTSMS model}
\label{fig:model:mtsdb}
\end{figure}

The general schema of the MTSMS model can be seen in figure
\ref{fig:model:mtsdb}.  A \emph{multiresolution database} is a
collection of \emph{resolution discs}, which temporarily accumulate
the \emph{measures} in a \emph{buffer} where they are processed and
finally stored in a \emph{disc}. Mainly, the data process is intended
to change the time intervals between \emph{measures} in order to
compact the time series information. In this way, the time series gets
stored in different time resolutions, which are spread in the
\emph{discs}.

\emph{Discs} are size bounded so they only contain a fixed amount of
\emph{measures}. When a \emph{disc} gets full it discards a
\emph{measure}. In this way, the multiresolution database is bounded
in size and the time series gets stored in pieces, that is 'time
subseries'.




Regarding operations, MTSMS model needs operators to change the time
intervals between measures. Mainly, these operators are
\emph{interpolation} functions and \emph{consolidation} actions. In
this section we design the basic MTSMS model, that is six basic data
model definitions -- \emph{measure}, \emph{time series},
\emph{buffer}, \emph{disc}, \emph{resolution disc}, and
\emph{multiresolution database} -- and the operations to create a
\emph{multiresolution database}, to add \emph{measures} and to
\emph{interpolate} and \emph{consolidate} time series.






\subsection{Buffer}\label{sec:model:buffer}

A buffer is a container for a regular or a no-regular time series. The
buffer objective is to regularise the time series with predetermined $\delta$ 
and attribute function. We call consolidation to this action. In the context
of buffers, the sampling period is called consolidation step
and the function is called attribute interpolation function.

\begin{definition}[Buffer]
  A \emph{buffer} is defined as the tuple $(S,\tau,\delta,f)$ where
  $S$ is a time series, $\tau$ is the last consolidation time, $\delta$
  is the duration of the consolidation step and $f$ is an
  attribute interpolation function.
\end{definition}

An empty buffer, or the initial buffer, $B_{\emptyset} =
(\emptyset,t_0, \delta, f)$ is a buffer that has an empty time series,
an initial consolidation time and predetermined $\delta$ and $f$. From
an empty buffer all the consolidation time instants can be calculated
as $t_0+k\delta, k\in\mathbb{N}$.

We define the operator \emph{addBuffer} as the addition of a new
measure to buffer's time series, $\text{addBuffer}: B =
(S,\tau,\delta,f) \times m = (v,t) \mapsto B'$ where
$B'=(S',\tau,\delta,f)$ and $S' = S \cup \{m\} $.
\[
\text{addBuffer}: \text{Buffer} \times \text{Measure} \longrightarrow
\text{Buffer}
\]



We say the buffer is ready to consolidate when a time of a measure is
bigger than the buffer's next consolidation time.  Let
$B=(S,\tau,\delta,f)$ be a buffer and $m=\max(S)$ the maximum measure,
$B$ is ready to consolidate if and only if $T(m) \geq \tau+\delta$.


%\subsubsection{Consolidation}

Let $B=(S,\tau,\delta,f)$ be a buffer ready to consolidate, the
consolidation from $B$ in the time interval $i=[\tau,\tau+\delta]$
results in a measure $m'=(v,\tau+\delta)$ where $m'=f(S,i)$. Attribute
interpolation function $f$ is described next in
section~\ref{sec:model:interpolador}.  We define the operator
\emph{consolidateBuffer} that calculates the measure of consolidation
and reduces the consolidated part of the time series from the
buffer. In a simplified, the \emph{consolidateBuffer} is only applied
to the present consolidation interval, $\text{consolidateBuffer}:
B=(S,\tau,\delta,f) \mapsto B' \times m' $ where $ B'=
(S',\tau+\delta,\delta,f)$, $ S' = S$ and $m' =
f(S,[\tau,\tau+\delta])$. Note that the resulting buffer's time series
can be reduced, such as $ S' = S(\tau+\delta,\infty)$, when the
historic is no more needed.
  \[
  \text{consolidateBuffer}: \text{Buffer} \longrightarrow \text{Buffer}
  \times \text{Measure}
  \]








\subsection{Disc}\label{sec:model:disc}

A disc is a container with a finite capacity. Each time series stored
in a disc has its cardinal bounded. When the cardinal of the time
series is to overcome the limit, some measures need to be discarded.

\begin{definition}[Disc]
  A \emph{disc} is a tuple $(S,k)$ where $S$ is a time
  series and $k\in\mathbb{N}$ is the maximum allowed cardinal of $S$.
\end{definition}

An empty disc $D_{\emptyset} = (\emptyset,k)$ is a disc with an empty
time series and the $k$ maximum cardinal that $S$ is allowed to take.

The cardinal of the times series is kept under control by the add
operator.  The operator \emph{addDisc} is defined as the procedure to
add a measure to the time series stored on the disc. If the predefined
capacity is exceeded, the minimum measure of the time series is
discarded, $\text{addDisc}: D=(S,k) \times m \mapsto D'$ where $ D' =
(S',k)$, $ S' =
  \begin{cases}
      S\cup\{m\} &\text{if }  |S|<k\\
      (S-\{\min(S)\}) \cup \{m\} & \text{else }
    \end{cases}  
    $
  \[
  \text{addDisc}: \text{Disc} \times \text{Measure} \longrightarrow \text{Disc}
  \]



\subsection{Resolution disc}

A resolution disc is a disc which stores a regular time series. It is
composed of a disc and a buffer with the time series to be
regularised.

\begin{definition}[Resolution disc]
  A \emph{resolution disc} is a tuple $(B,D)$ where $B$
  is a buffer and $D$ is a disc.
\end{definition}
 
On the one hand, the definitions of empty buffer and empty disc imply
an empty resolution disc $R_{\emptyset} = (B_{\emptyset},D_{\emptyset})$.

On the other hand, the operators of a resolution disc are related to
the buffer and disc ones.

Operator \emph{addResolutionDisc} is the addition of a measure to the
buffer of the resolution disc, $\text{addResolutionDisc } : R=(B,D) \times m \mapsto R'$ where
$R'= (B',D)$ and $B'= B \text{ addBuffer } m$.
\[
\text{addResolutionDisc}: \text{Resolution Disc} \times \text{Measure}
\longrightarrow \text{Resolution Disc}
\]

Let $R=(B,D)$ be a resolution disc, $R$ is ready to consolidate if and
only if $B$ is ready to consolidate.

If the resolution disc is ready to consolidate, it can be
consolidated.  Operator \emph{consolidateResolutionDisc} calculates a
consolidation measure from the buffer and adds it to the disc,
$\text{consolidateResolutionDisc } : R=(B,D) \mapsto R'$ where $R'=
(B',D')$, $B' \times m'= \text{ consolidateBuffer } B $ and $ D'= D
\text{ addDisc } m'$.
\[
\text{consolidate}: \text{Resolution Disc} \longrightarrow
\text{Resolution Disc}
\]




\subsection{Multiresolution Database}\label{sec:model:rrd}

A multiresolution database is an archive of resolution discs which
share the input of measures, that is they store the same time
series. A time series is stored regularised and distributed with
different resolutions in the various resolution discs, as has been seen
in figure~\ref{fig:model:mtsdb}.

\begin{definition}[Multiresolution Database]
  A \emph{Multiresolution Database} is a set of resolution discs
  $M=\{R_0,\dotsc,R_d\}$.
\end{definition}

An empty multiresolution database has empty resolution discs $M_{\emptyset}=\{R_{0_{\emptyset}},\dotsc,R_{d_{\emptyset}\}}$. 
 
Generally, in a multiresolution database there are not two resolution discs
with the same information. That is, let $R_a = (B_a, D_a)$ and $R_b =
(B_b, D_b)$ be two resolution discs, its buffers
$B_a=(S_a,\tau_a,\delta_a,f_a)$ and $B_b=(S_b,\tau_b,\delta_b,f_b)$
have different consolidation interval and attribute interpolation function
$\delta_a \neq \delta_b \wedge f_a \neq f_b$.


With reference to the operators, the add and consolidate in a
multiresolution database are applied to every resolution disc it
contains.


Operator \emph{addMD} is defined as the addition of a measure to every
resolution disc, $\text{addMD } : M=\{R_0,\dotsc,R_d\} \times m
\mapsto M' $ where $M'= \{ \forall R_i\in M: R_i \text{
  addResolutionDisc } m \}$.
\[
\text{addMD}: \text{Multiresolution Database} \times \text{Measure}
\longrightarrow \text{Multiresolution database}
\]


Operator \emph{consolidateMD} consolidates the resolution discs that
are ready to consolidate, $\text{consolidateMD } :
M=\{R_0,\dotsc,R_d\} \mapsto M'$ where $ M'= \big\{ \forall R_i\in M:
  \begin{cases}
    \text{ consolidateResolutionDisc } R_i & \text{if } R_i \text{ ready to consolidate} \\
    R_i & \text{else }
  \end{cases}\big\}
  $.
\[
\text{consolidate}: \text{Multiresolution Database} \longrightarrow
\text{Multiresolution Database}
  \]








\section{Attribute interpolation function}\todo{potser dir-li aggregate? en catalÃ  com en direm?}
\label{sec:model:interpolador}


An attribute interpolation function is used when a buffer is
consolidated in order to summarise information from the time series.
Let $S$ be a time series and $t_0$ and $t_f$ two time instants, an
attribute interpolation function $f$ calculates a measure that
summarises an attribute of $S$ in the time interval $i=[T_0,T_f]$:
\[
f: \text{Time series} \times \text{time interval} \longrightarrow
\text{Measure}
\]
\[
f: S=\{m_0,\ldots,m_k\} \times i=[T_0,T_f] \mapsto m'
\]

There can be different attribute interpolation functions in order to
summarise a time series. As instance, we may want to calculate
statistics from a time series such as the maximum value, the average
or apply digital signal processing operations as is done in
\cite{zhang11}.


We can globally define the behaviour of attribute interpolation
functions in the discrete (set) and continuous forms. However, $T(m')$
rest undefined as the resulting consolidation time is subject to
interpretation, which we discuss below. Next, we exemplify some
operators for both cases.

First, purely discrete interpolation (d) which resembles typical set
operators. We must define the consolidation interval depending on $i$,
let $S'=S(T_0,T_f]$:
\begin{itemize}
\item maximum$^d$: $S \times i \mapsto m'$ where $V(m') = \max_{\forall m
    \in S'}(V(m))$. It summarises $S'$ with the maximum of
  the measure values.
\item last$^d$: $S \times i \mapsto m'$ where $V(m') = \max(S')$. It
  summarises $S'$ with the maximum measure.
\item arithmetic mean$^d$: $S \times i \mapsto m'$ where $V(m') =
  \frac{1}{|S'|} \sum\limits_{\forall m\in S'} V(m)$. It
  summarises $S'$ with the mean of the measure values.
\end{itemize}


Second, continuous interpolation (c). Note that we need a continuous
function $S(t)$ which is discussed below. Let $t\in\mathbb{R}$:
\begin{itemize}
\item maximum$^c$: $S \times i \mapsto m'$ where $V(m') = \max_{\forall t
    \in [T_0,T_f]}(S(t))$. It summarises $S(t)$ with the maximum in
  interval $i$.
\item last$^c$: $S \times i \mapsto m'$ where $V(m') = S(T_f)$. It
  summarises $S(t)$ with the last value in interval $i$.
\item average$^c$: $S \times i \mapsto m'$ where $V(m') =
  \frac{\int_{T_0}^{T_f} S(t)dt}{T_f-T_0}$. It summarises $S(t)$ with
  the average value, that is the area, in interval $i$. $S(t)$ must be
  continuous on the closed interval.
\end{itemize}


In the design of the attribute interpolation function we can interpret
a time series in different ways, that is what we call the
representation of a time series. Keogh et al.\ \cite{last:keogh} cite
some possible representations for time series such as \emph{Fourier
  Transforms}, \emph{Wavelets}, \emph{Symbolic Mappings} or
\emph{Piecewise Linear Representation} (PLR). This last is remarked as
the most used owing to the most common representation is with linear
functions \cite{keogh01}.

The variety of time series representations results in a variety of the
same attribute interpolation functions. As instance, a maximum
attribute interpolation function may give different values if we
consider a linear or a constant piecewise representation. Therefore,
the time series representation results in attribute interpolation
functions families.


Next, we show two possible families for attribute interpolation
functions: one for time series represented by a staircase function and
another by a impulse train function.

First, we show some attribute interpolation functions for time series
represented by a staircase function, that is with a piecewise constant
representation.  We define a new representation for time series called
\emph{zero-order hold backwards}
(zohe%from \emph{zero-order hold everted}
) consisting in holding each value until the preceding value, which a
similar representation is used by RRDtool \cite{lisa98:oetiker}.

Let $S=\{m_0,\ldots,m_k\}$ be a time series, we define
$S(t)^{\text{zohe}}$ as its \emph{zero-order hold backwards}
continuous representation along time $t$:
%continuous definition of the time series using left-continuous step functions.
\[
\forall t \in \mathbb{R}  ,\forall m \in S:
S(t)^{\text{zohe}} =  
\begin{cases}
  \infty & \text{if } t > T(\max S) \\%\text{not defined}
  V(m) & \text{if }  t\in (T(\prev_S m),T(m)]
\end{cases}
\]


We now define the \emph{zero-order hold backwards} attribute
interpolation function family as the one interpreting the
consolidation time interval left-continuous $i=(T_0,T_f]$ and the
resulting interpolated measure's time always being $T_f$, in
accordance to the \emph{zero-order hold backwards} representation
being defined using left-continuous step functions.  Let
$S=\{m_0,\ldots,m_k\}$ be a time series and $i=[T_0,T_f]$ be a time
interval, the attribute interpolation function $f^{\text{zohe}}\in f$
summarises $S$ with a measure, $f^{zohes}: S=\{m_0,\ldots,m_k\} \times
i=[T_0,T_f] \mapsto m'$ where $m'=(v',T_f)$ and the resulting value
$v'$ depends on the attribute interpolation function calculated from
the subset $S^{zohe}=(S(T_0,T_f] \cup \{\min(S-S(-\infty,Tf))\}$.
% hauria de ser seltemp:$S[t_0,t_f]^{zohe}$.

On the one hand, purely discrete zohe interpolation functions (zohed)
have $T(m')=T_f$ and remain with $V(m')$ as defined above except for
$S'$, let now $S'=S^{zohe}$:
\begin{itemize}
\item maximum$^{zohed}$: $S \times i \mapsto m'$ where $V(m') =
  \max_{\forall m \in S'}(V(m))$ and $T(m')=T_f$.
\item last$^{zohed}$: $S \times i \mapsto m'$ where $V(m') = \max(S')$ and
  $T(m')=T_f$.
\item arithmetic mean$^{zohed}$: $S \times i \mapsto m'$ where $V(m')
  = \frac{1}{|S'|} \sum\limits_{\forall m\in S'} V(m)$ and
  $T(m')=T_f$. 
\end{itemize}
On the other hand, continuous zohe interpolation functions (zohec)
have also $T(m')=T_f$ and we must define $V(m')$ in the piecewise
approach, let now $S'=S^{zohe}$:
\begin{itemize}
\item maximum$^{zohec}$: $S \times i \mapsto m'$ where $V(m') =
  \max_{\forall m \in S'}(V(m))$ and $T(m')=T_f$.
%Note: \emph{Minimum interpolation} can be defined dually.
\item last$^{zohec}$: $S \times i \mapsto m'$ where $V(m') = \max(S')$
  and $T(m')=T_f$.
\item average$^{zohec}$: $o=\min(S')$, $n=\max(S')$ , $S''= S' -
  \{o\}:$ $S \times i \mapsto m'$ where $V(m') = \frac{1}{T_f-T_0}
  \big[ (T(o)-T_0)V(o) -( T(n)-T_f)V(n) + \sum\limits_{\forall m \in
    S''}( T(m)- T(\prev_S m) )V(m) \big]$ and $T(m')=T_f$.
% \[
%   \begin{split}
%   T(m')  = & \frac{1}{T_f-T_0} 
%   \big[ (T(o)-T_0)V(o) -( T(n)-T_f)V(n) \\
%     & {}+\sum\limits_{\forall m \in S''}( T(m)- T(\prev_S m) )V(m) \big]   
%    \end{split}
%   \]
\end{itemize}



Second, we show attribute interpolation functions for time series
represented by a impulse train function, that is by Dirac delta
functions.  We define a new representation for time series called
\emph{Dirac delta} ($\delta$) based on the Dirac delta, which is a
function that is zero everywhere except at zero.

Let $S=\{m_0,\ldots,m_k\}$ be a time series, we define $S(t)^{\delta}$
as its \emph{Dirac delta} continuous representation along time $t$:
\[
\forall t \in \mathbb{R}  ,\forall m \in S:
S(t)^{\delta} =  \sum V(m)\delta(t-T(m)) =
\begin{cases}
  V(m) & \text{if }  t=T(m) \\
  0 & \text{else} 
\end{cases}
\]

We now define the \emph{Dirac delta} attribute interpolation function
family as the one interpreting the consolidation time interval closed
$i=[T_0,T_f]$ and the resulting interpolated measure's time always
being $\frac{T_f+T_0}{2}$.  Let $S=\{m_0,\ldots,m_k\}$ be a time
series and $i=[T_0,T_f]$ be a time interval, the attribute
interpolation function $f^{\delta}\in f$ summarises $S$ with a
measure, $f^{\delta}: S=\{m_0,\ldots,m_k\} \times i=[T_0,T_f] \mapsto
m'$ where $m'=(v',\frac{T_f+T_0}{2})$ and the resulting value
$v'$ depends on the attribute interpolation function calculated from
the subset $S^{\delta}=S-(S(-\infty,T_0)+S(T_f,+\infty))$.
% equivalent a l'interval tancat S[T_0,T_f]

On the one hand, purely discrete $\delta$ interpolation functions
($\delta d$) have $T(m')=\frac{T_f+T_0}{2}$ and remain with $V(m')$ as
defined above, let now $S'=S^{\delta}$:
\begin{itemize}
\item maximum$^{\delta d}$: $S \times i \mapsto m'$ where $V(m') =
  \max_{\forall m \in S'}(V(m))$ and $T(m')=\frac{T_f+T_0}{2}$.
\item last$^{\delta d}$: $S \times i \mapsto m'$ where $V(m') =
  \max(S')$ and $T(m')=\frac{T_f+T_0}{2}$.
\item arithmetic mean$^{\delta d}$: $S \times i \mapsto m'$ where $V(m')
  = \frac{1}{|S'|} \sum\limits_{\forall m\in S'} V(m)$ and
  $T(m')=\frac{T_f+T_0}{2}$. 
\end{itemize}
On the other hand, continuous $\delta$ interpolation functions
($\delta c$) have also $T(m')=\frac{T_f+T_0}{2}$ and we must define
$V(m')$ in the piecewise approach, let now $S'=S^{\delta}$:
\begin{itemize}
\item maximum$^{\delta c}$: $S \times i \mapsto m'$ where $V(m') = \max(0,
  \max_{\forall m \in S'}(V(m)))$ and $T(m')=\frac{T_f+T_0}{2}$.
\item last$^{\delta c}$: $S \times i \mapsto m'$ where $V(m') = 
\begin{cases}
V(m) & \text{if } m\in S':T(m)=T_f \\
0 & \text{else}
\end{cases}$ and $T(m')=\frac{T_f+T_0}{2}$.
\item average$^{\delta c}$: $S \times i \mapsto m'$ where $V(m') =
  \sum\limits_{\forall m \in S'} V(m)$ and
  $T(m')=\frac{T_f+T_0}{2}$. Note that delta function has the
  fundamental property $\int \delta(t)dt = 1$.
\end{itemize}

In these two families shown, the continuous and the discrete form for
maximum and last functions coincide in the zohe interpretation but do
not coincide in the $\delta$ interpretation. 



\todo{Teresa: afegir interpoladors d'unknown}

\todo{In conclusion, infinite attribute interpolation functions can be
defined and no global assumptions can be made. MTSMS must give freedom to the users to define their own functions.}



%%% Local Variables:
%%% TeX-master: "main"
%%% ispell-local-dictionary: "british"
%%% End:
% LocalWords: buffer buffers  MTSMS multiresolution DBMS zohe





