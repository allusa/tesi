\section{Multiresolution TSMS model definition}\label{sec:MTSMS}

In this section we design a mathematical model for the multiresolution time series database management systems (MTSMS). Some concepts come from an abstraction of RRDtool operations \parencite{rrdtool}. 

A MTSMS manages time series. A time series is regarded as a chronological data collection, so it needs an appropriate management by the DBMS.
The MTSMS model is an storage solution for a time series where, in short,  the time series information is spread in different time resolutions. 

The main objects of a MTSMS are \emph{measures} and \emph{time series}. A \emph{measure} is a value measured in an instant in time and a  \emph{time series} is a collection of \emph{measures}. A database from a MTSMS contains one time series, which internally is stored in multiple resolutions of itself.

\begin{figure}[tp]
\centering
\setlength{\unitlength}{0.3mm}
\input{imatges/mtsdb-internal_architecture.tex}
\caption{Architecture of MTSMS model}
\label{fig:model:mtsdb}
\end{figure}

The general schema of the MTSMS model can be seen in figure \ref{fig:model:mtsdb}.  A \emph{multiresolution database} is a collection of \emph{resolution discs}, which temporarily accumulate the \emph{measures} in a \emph{buffer} where they are processed and finally stored in a \emph{disc}. Mainly, the data process is intended to change the time intervals between \emph{measures} in order to compact the time series information. In this way, the time series gets stored in different time resolutions, which are spread in the \emph{discs}.

\emph{Discs} are size bounded so they only contain a fixed amount of \emph{measures}. When a \emph{disc} gets full it discards a \emph{measure}. In this way, the multiresolution database is bounded in size and the time series gets stored in pieces, that is 'time subseries'.



\begin{figure}[tp]
\centering
\input{imatges/mtsdb-time_window.tex}
\caption{Example of different resolutions for a time series in a MTSDB}
\label{fig:model:window}
\end{figure}

Putting resolution and 'time subseries' together, in a multiresolution database a time series is stored in different resolution pieces. For example, we could have a time series stored with high resolution at recent times and with low resolution at older times. This example is illustrated in figure \ref{fig:model:window}. At the top there are three \emph{discs} with different number of \emph{measures} and at the bottom there is a timeline showing the time series chopped along time. For recent times, every 2 hours a \emph{measure} is stored in the third \emph{disc} which has a capacity of 24 \emph{measures} so that results in a 2 day piece. For mid times, every 1 day a  \emph{measure} is stored in the second \emph{disc} which has a capacity of 12 \emph{measures} so that results in a 12 days piece. For old times, every 5 days a  \emph{measure} is stored in the first \emph{disc} which has a capacity of 6 \emph{measures} so that results in a 30 days piece. 


Regarding operations, MTSMS model needs operators to change the time intervals between measures. Mainly, these operators are \emph{interpolation} functions and \emph{consolidation} actions. In this section we design the basic MTSMS model, that is six basic data model definitions -- \emph{measure}, \emph{time series}, \emph{buffer}, \emph{disc}, \emph{resolution disc}, and \emph{multiresolution database} -- and the operations to create a \emph{multiresolution database}, to add \emph{measures} and to \emph{interpolate} and \emph{consolidate} time series.



\subsection{Measure}

\begin{definition}[Measure]
  \label{def:measure}
  A \emph{measure} is a tuple $(v,t)$ where $v\in{\mathbb{R}}$ is the
  value of the measure and $t \in \mathbb{R}$ is the instant in time
  of measurement.
\end{definition}

Let $m=(v,t)$ be a measure, $v$ is written as $V(m)$ and $t$
is written as $T(m)$.

\begin{definition}[Time]
  \label{def:time}
  Let $t^i_i$ and $t^i_j$ be two instants in time, we define the
  amount of time or duration $t^d$ as the value $t^d \in\mathbb{R}$
  measuring the distance in time units between the two instants $t^d =
  t^i_i - t^i_j$.

  Let $t^d$ be a duration and $t^{R}$ an instant in time of reference,
  we define the instant in time $t^i$ as the value $t^i \in\mathbb{R}$
  measuring the amount of time from the time of reference $t^i= t^{R}
  + t^d$. The value of the time of reference is also an instant in
  time but it can define exactly the position of any other instant in
  time.

  % This definition is coherent with the one given in coordinate
  % systems, \cite{wiki:coordinate}.  Time is treated as universal and
  % constant. Time values are expressed in time units, that is seconds
  % in the international system.
\end{definition}

Time values are expressed in time units, that is seconds in the international system. The time value defines the order between measures.

\begin{definition}
  \label{def:order-relation}
  Let $m=(v_m,t_m)$ and $n=(v_n,t_n)$ be two measures, then $m\geq n$
  if and only if $t_m\geq t_n$.
\end{definition}

\subsection{Time series}

Time series are sequences of measures that are ordered in time. They
are also called time sequences such as in \cite{last:hetland}.

\begin{definition}[Time series]
  A \emph{time series} $S$ is defined as a set of measures
  $S=\{m_0,\ldots,m_k\}$ without repeated time values $\forall i,j:
  i\leq k, j\leq k, i\neq j : T(m_i)\neq T(m_j)$. We will refer to the
  number of measures of the time series as the cardinality of the set
  $|S|$.
\end{definition}

The order defined in \ref{def:order-relation} implies a total order in
a time series. As a time series is a finite set, if it is not empty it
has a maximum and a minimum. 

\begin{definition}
  Let $S=\{m_0,\ldots,m_k\}$ be a time series and $n\in S$ be a
  measure. The time series' maximum is $n=\max(S)$ if and only if
  $\forall m \in S: n \geq m $.  Similarly, the time series' minimum
  is $n=\min(S)$ if and only if $\forall m \in S: n \leq m$.
\end{definition}

Given the order defined by time in \ref{def:order-relation}, in a time
series we define the sequence interval similarly as it is done in \cite{last:keogh,last:hetland}.

\begin{definition}
  Let $S=\{m_0, \ldots, m_k\}$ be a time series. We define the subset
  $S(r,t] \subseteq S$ as the time series $S(r,t]=\{m\in S |
  r<T(m)\leq t\}$, where $r$ and $t$ are two instants in time.

  We also define the subset $S(r,+\infty)\subseteq S$ as the time
  series $S(r,+\infty) = \{m\in S | r< T(m) \leq T(\max(S))\}$ and the
  subset $S(-\infty,t)\subseteq S$ as the time series $S(-\infty,t) =
  \{m\in S | T(\min(S))\leq T(m) < t\}$.
\end{definition}

The time order in time series also implies the sequence concept of
next and previous measure.

\begin{definition}
  Let $S=\{m_0, \ldots, m_k\}$ be a time series and $l\in S$ and $n$
  two measures. We define the next measure of $n$ in $S$ as
  $l=\nex\limits_S(n)$ where $l = \min(S(T(n),+\infty))$. We define
  the previous measure of $n$ in $S$ as $l=\prev\limits_S(n)$ where $l =
  \max(S(-\infty,T(n)))$.
\end{definition}

When it is clear the time series which imposes the time order, we may
write $\nex(m)$ i $\prev(m)$.



\subsubsection{Regularity of time series} 

Let $S=\{m_0,\ldots,m_k\}$ be a time series, $t$ an instant in temps
and $\delta$ a duration of time, the time series' measures can be
situated in the time interval $i_0=[t,t+\delta]$ and its multiples
$i_j=[t+j\delta \,,\, t+(j+1)\delta]: j=0,1,2,\ldots$. When the
measures are equally spaced the time series is called regular.

\begin{definition}[Regular time series]
  Let $S=\{m_0,\ldots,m_k\}$ be a time series, $t$ an instant in time
  and $\delta$ a duration of time. We define $S$ as regular if and
  only if $\forall m \in S(T(\min(S),+\infty):T(m) - T(\prev(m)) =
  \delta$ and $T(\min(S))=t$.
\end{definition}

In signal processing, these time intervals are called sampling
intervals, $\delta$ is called sampling period and $t$ is called
sampling initial time.  


\subsection{Buffer}\label{sec:model:buffer}

A buffer is a container for a regular or a no-regular time series. The
buffer regularises the time series with a function to a constant
sampling period. We call consolidation to this action. In the context
of buffers, the constant sampling period is called consolidation step
and the function is called interpolation.

\begin{definition}[Buffer]
  A \emph{buffer} is defined as the tuple $(S,\tau,\delta,f)$ where
  $S$ is a time series, $\tau$ is the last consolidation instant in
  time, $\delta$ is the duration of the consolidation step and $f$ is
  an interpolation.
\end{definition}

An empty buffer, or the initial buffer, $B_{\emptyset} =
(\emptyset,t_0, \delta_0, f)$ is a buffer that has an empty time
series, the initial time of consolidation a duration indicating the
consolidation step and an interpolation. From the empty buffer all the
instants in time of consolidation can be calculated as $t_0+k\delta,
k\in\mathbb{N}$. 

Before the consolidation the buffer needs measures. For this purpose
we define an operator.

\begin{definition}
  The operator \emph{add} adds a measure to the time series of a buffer:
  \[
  \text{add}: \text{Buffer} \times \text{Measure} \longrightarrow \text{Buffer}
  \]
  \[
   B = (S,\tau,\delta,f)  \times m = (v,t) \mapsto B'= (S',\tau,\delta,f),
   S' = S \cup \{m\}
   \] 
\end{definition}

A predicate will become true when the buffer is ready to consolidate.

\begin{definition}
  We say the buffer is ready to consolidate when a time of a measure
  is bigger than the buffer's next instant in time of consolidation.
  Let $B=(S,\tau,\delta,f)$ be a buffer and $m=\max(S)$ the maximum
  measure, $B$ is ready to consolidate if and only if $T(m) \geq
  \tau+\delta$.
\end{definition}

\subsubsection{Interpolation}

When a buffer is ready to consolidate an interpolation functions is
used in order to consolidate the buffer.  Let $S$ be a time series and
$t_0$ and $t_f$ two instants in time, an interpolation function $f$
calculates a measure that is a summary of $S$ in the time interval
$i=[T_0,T_f]$:
\[
f: \text{Time series} \times \text{time interval} \longrightarrow
\text{Measure}
\]


In the design of the interpolation function we can interpret a time
series in different ways. \textcite{last:keogh}, cites
some possible representations for time series such as \emph{Fourier
  Transforms}, \emph{Wavelets}, \emph{Symbolic Mappings} or
\emph{Piecewise Linear Representation} (PLR), remarking this last as
the most used. The most common representation is with linear
functions \parencite{keogh01}.

It is also possible to represent a time series with staircase
function, that is with a piecewise constant representation. In signal
theory it is widely used in digital-to-analog converter and the model
is known as \emph{zero-order hold}, which consists in holding each
value until the following value. Extending this model we define a new
interpretation for time series called \emph{zero-order hold backwards}
that is the representation used by RRDtool \parencite{lisa98:oetiker}.

\emph{Zero-order hold backwards} consists in holding each value until
the preceding value. Next, it is exemplified with a continuous
definition of a time series using left-continuous step functions.

\begin{definition}[zero-order hold backwards]
  Let $S=\{m_0,\ldots,m_k\}$ be a time series, $S(t)$ is the
  continuous representations along time $t$:
\[
\forall t \in \mathbb{R}  ,\forall m \in S:
S(t) =  
\begin{cases}
  \text{not defined} & \text{if } t > T(\max S) \\
  V(m) & \text{if }  t\in (T(\prev m),T(m)]
\end{cases}
\]
\end{definition}


There can be different interpolation functions in order to summarise a
time series. The representation of the time series can also make
differences to the same interpolation functions. Below are some
examples for time series represented by \emph{zero-order hold
  backwards}, where the time interval of consolidation is interpreted
left-continuous $(T_0,T_f]$.



\begin{definition}[Interpolation examples]
  Let $S=\{m_0,\ldots,m_k\}$ be a time series interpreted
  \emph{zero-order hold backwards} and $i=[T_0,T_f]$ be a time
  interval, the interpolation function summarises $S$ with a measure
  that is calculated from the measure values belonging to the subset
  $S(T_0,T_f]$:
  \[
  f: \text{Time series} \times \text{time interval}
  \longrightarrow \text{Measure}
  \]
  \[
  S=\{m_0,\ldots,m_k\} \times i=[T_0,T_f] \mapsto m'=(v',T_f)
  \]

  The resulting value $v'$ depends on the interpolation function:

\begin{itemize}

\item \emph{Arithmetic mean interpolation} function summarises $S$
  with the mean of the measure values
  \[
  S'=S(T_0:T_f]:
  v' = \frac{1}{|S'|} \sum\limits_{\forall m\in S'} V(m)
  \]

\item \emph{Maximum interpolation} function summarises $S$ with the
  maximum of the measure values
  \[
  S'=S(T_0:T_f]:
  v' = \max_{\forall m \in S'}(V(m))
  \]
 %Note: \emph{Minimum interpolation} can be defined dually.
\item \emph{Last interpolation} function summarises $S$ with the
  maximum measure.
  \[
  S'=S(T_0:T_f]:
  v' = \max(S')
  \]

\item \emph{Area interpolation} function summarises $S$ keeping the
  area of the region.
  \[
  o=\min(S(T_0:T_f]),
  S'= S(T_0:T_f] - \{o\},
  n=\nex\limits_S \max(S'): 
  \]
  \[
  \begin{split}
  :v'  = & \frac{1}{T_f-T_0} 
  \big[ (T(o)-T_0)V(o) +( T_f- T(\prev\limits_S n) )V(n) \\
    & {}+\sum\limits_{\forall m \in S'}( T(m)- T(\prev\limits_S m) )V(m) \big]   
   \end{split}
  \]
  
  Note: if we consider the continuous definition of $S$ we can see the
  interpolation function as $v' = \frac{\int_{T_0}^{T_f} S(t) dt}{T_f
    - T_0}$

\end{itemize}

\end{definition}


\subsubsection{Consolidation}

Let $B=(S,\tau,\delta,f)$ be a buffer ready to consolidate, the
consolidation from $B$ in the time interval $i=[\tau,\tau+\delta]$
results in a measure $m'=(v,\tau+\delta)$ where $m'=f(S,i)$ and $f$ is
an interpolation function.

\begin{definition}
  The operator \emph{consolidate} calculates the measure of
  consolidation and reduces the consolidated part of the time series
  from the buffer. In a simplified, the \emph{consolidate} is only
  applied to the present consolidation interval.
  \[
  \text{consolidate}: \text{Buffer} \longrightarrow \text{Buffer}
  \times \text{Measure}
  \]
  \[
  B=(S,\tau,\delta,f) \mapsto B' \times m'
  \]
  \[
  B'= (S',\tau+\delta,\delta,f)
  \]
  \[
  S' = S(\tau+\delta,\infty)
  \]
  \[
  m' = f(S,[\tau,\tau+\delta]): f \text{ is an interpolation}
  \]
\end{definition}



\subsection{Disc}\label{sec:model:disc}

A disc is a container for a time series where its
cardinal is bounded. When the cardinal of the times series is to overcome the limit, some measures need to be discarded. 

\begin{definition}[Disc]
  A \emph{disc} is defined as the tuple $(S,k)$ where $S$ is a time
  series and $k\in\mathbb{N}$ is the maximum cardinal of $S$.
\end{definition}

An empty disc $D_{\emptyset} = (\emptyset,k)$ is a disc with an empty
time series and the $k$ maximum cardinal that $S$ is allowed to take.

 The cardinal of the times series is kept under control by the add operator. 

\begin{definition}
  The operator \emph{add} add a measure to the time series of the
  disc. If the limited cardinal of the times series is exceeded, the
  minimum measure is discarded.
  \[
  \text{add}: \text{Disc} \times \text{Measure} \longrightarrow \text{Disc}
  \]
  \[
  D=(S,k) \times m \mapsto D'= (S',k)
  \]
  \[
  S' =  
  \begin{cases}
      S\cup\{m\} &\text{if }  |S|<k\\
      (S-\{\min(S)\}) \cup \{m\} & \text{else }
    \end{cases}  
  \]
\end{definition}


\subsection{Resolution disc}

A resolution disc is a disc with a regular time series and a buffer
with a time series pending regularisation.

\begin{definition}[Resolution disc]
  A \emph{resolution disc} is a tuple $(B,D)$ where $B$
  is a buffer and $D$ is a disc.
\end{definition}
 
On the one hand, the definitions of empty buffer and empty disc imply
an empty resolution disc $R_{\emptyset} = (B_{\emptyset},D_{\emptyset})$.

On the other hand, the operators of a resolution disc are related to
the buffer and disc ones.

\begin{definition}
  Operator \emph{add} adds a measure  to the buffer of the resolution disc:
  \[
  \text{add}: \text{resolution disc} \times \text{Measure}
  \longrightarrow \text{resolution disc}
  \]
  \[
  R=(B,D) \times m \mapsto R'= (B',D)
  \]
  \[
  B'= B \text{ add } m
  \]
\end{definition}

\begin{definition}
  Let $R=(B,D)$ be a resolution disc, $R$ is ready to consolidate if
  and only if $B$ is ready to consolidate.
\end{definition}

If the resolution disc is ready to consolidate, it can be consolidated.

\begin{definition}
  Operator \emph{consolidate} calculates a consolidation measure from
  the buffer and adds it to the disc.
  \[
  \text{consolidate}: \text{resolution disc} \longrightarrow
  \text{resolution disc}
  \]
  \[
  R=(B,D) \mapsto R'= (B',D')
  \]
  \[
  B' \times m'= \text{ consolidate } B 
  \]
  \[
  D'= D \text{ add } m'
  \]
\end{definition}



\subsection{Multiresolution Database}\label{sec:model:rrd}

A multiresolution database is an archive of resolution discs which
share the input of measures, that is they store the same time
series. A time series is stored regularised and distributed with
different resolutions in the various resolution discs, as has been seen
in figure~\ref{fig:model:mtsdb}.

\begin{definition}[Multiresolution Database]
  A \emph{Multiresolution Database} is a set of resolution discs
  $M=\{R_0,\dotsc,R_d\}$.
\end{definition}

An empty multiresolution database has empty resolution discs $M_{\emptyset}=\{R_{0_{\emptyset}},\dotsc,R_{d_{\emptyset}\}}$. 
 
Generally, in a multiresolution database there are not two resolution discs
with the same information. That is, let $R_a = (B_a, D_a)$ and $R_b =
(B_b, D_b)$ be two resolution discs, its buffers
$B_a=(S_a,\tau_a,\delta_a,f_a)$ and $B_b=(S_b,\tau_b,\delta_b,f_b)$
have different consolidation interval and interpolation function
$\delta_a \neq \delta_b \wedge f_a \neq f_b$.


With reference to the operators, the add and consolidate in a multiresolution database are applied to every resolution disc it contains.


\begin{definition}
  Operator \emph{add} adds a measure to every resolution disc:
  \[
  \text{add}: \text{multiresolution database} \times \text{Measure}
  \longrightarrow \text{multiresolution database}
  \]
  \[
  M=\{R_0,\dotsc,R_d\} \times m \mapsto M' 
  \]
  \[  
  M'= \{ \forall R_i\in M: R_i \text{ add } m \}
  \]
\end{definition}


\begin{definition}
  Operator \emph{consolidate} consolidates the resolution discs that
  are ready to consolidate.
  \[
  \text{consolidate}: \text{multiresolution database} \longrightarrow
  \text{multiresolution database}
  \]
  \[
  M=\{R_0,\dotsc,R_d\} \mapsto M'
  \]
  \[
  M'= \big\{
  \forall R_i\in M: 
  \begin{cases}
    \text{ consolidate } R_i & \text{if } R_i \text{ ready to consolidate} \\
    R_i & \text{else }
  \end{cases}\big\}
  \]
\end{definition}

%%% Local Variables:
%%% TeX-master: "article"
%%% ispell-local-dictionary: "british"
%%% End:
% LocalWords:  buffer buffers RRDtool MTSMS multiresolution DBMS





