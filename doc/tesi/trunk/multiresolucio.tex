
\chapter{Funció de multiresolució aplicada a les sèries temporals}


En aquest capítol definim la multiresolució com una funció que
s'aplica a una sèrie temporal i retorna una nova sèrie temporal.
Aquesta nova sèrie temporal és el resultat d'aplicar, en l'àmbit dels
\glspl{SGST}, un esquema de multiresolució a la sèrie temporal
original. Aquesta aplicació té el mateix efecte que utilitzar, en
l'àmbit dels \glspl{SGSTM}, una sèrie temporal multiresolució amb
aquest esquema, però en canvi les aplicacions que resulten d'ambdós
casos no tenen les mateixes propietats.

En el model de \gls{SGSTM} s'ha definit la
multiresolució com una estructura de base de dades en què cal
emmagatzemar i tractar una sèrie temporal. En canvi, ara observem la
multiresolució com una funció que opera sobre una sèrie
temporal i no té capacitats d'emmagatzematge de dades.  D'aquesta
manera, la funció de multiresolució permet:
\begin{itemize}

\item Expressar problemes en què la multiresolució sigui gestionada
  com una consulta sobre una sèrie temporal; és a dir, com una
  operació dels \gls{SGST} que calcula parelles d'agregació d'atributs
  i resolucions temporals per a una sèrie temporal de la mateixa
  manera com ho calculen els \gls{SGSTM} (segons el model del
  \autoref{cap:model:sgstm}).

\item Dissenyar sistemes duals de \glspl{SGSTM} i \glspl{SGST} amb
  operacions de consulta multiresolució, en els quals una sèrie
  temporal és emmagatzemada doblement en tots dos sistemes
  (\seeref{sec:multiresolucio:dual}).

\item Estudiar l'aplicació de la teoria de la informació per a
  l'efecte que produeix la multiresolució
  (\seeref{sec:multiresolucio:teoriainformacio}).

\item Estudiar altres implementacions de la consulta de
  multiresolució, per exemple amb computació distribuïda i para\l.lela
  (\seeref{sec:implementacio:mapreduce}).

\end{itemize}




%es podria implementar com una operació de summarize? \todo{}
A continuació descriurem com aplicar un esquema de
multiresolució a una sèrie temporal mitjançant les operacions mapa i
plec dels \gls{SGST}. Això serà equivalent funcionalment als
\gls{SGSTM}.



\section{Funció de multiresolució}
\label{sec:multiresolucio:funcio}



En el model de \gls{SGSTM} del \autoref{cap:model:sgstm} hem definit
un model de dades per a gestionar sèries temporals
multiresolució. Aquest model té una estructura que emmagatzema la
informació d'una sèrie temporal d'una forma determinada denominada
multiresolució.  Aquest model de \gls{SGSTM} té com a objectius
emmagatzemar compactament les dades i resumir la informació per a
consultes posteriors.

Així, aquest model té capacitats de computació sincronitzada o en
línia (\emph{online}) amb el temps i té característiques dels sistemes
que tracten fluxos de dades (\emph{data stream}); és a dir, dades que
s'adquireixen contínuament i cal anar gestionant al mateix temps que
es van adquirint. Això no treu, però, que de manera més simplificada
també es pugui treballar amb un \gls{SGSTM} en temps diferit
(\emph{offline}); és a dir, que primer s'emmagatzemin les dades
adquirides i després, en temps posteriors, s'hi apliqui la consolidació.



Això no obstant, podem simplificar el problema de càlcul de
multiresolució en temps diferit com una consulta, en l'àmbit dels
\gls{SGST}, que transforma una sèrie temporal a una nova sèrie
temporal.




\subsection{Context de la formulació}

Expressem el context de la funció de multiresolució que ens permet
formular dues operacions mapa i plec com a equivalents funcionalment a
un \gls{SGSTM}.
%
Els tres passos, de forma resumida, per a calcular la multiresolució
d'una sèrie temporal en un \gls{SGSTM} són els següents.


Sigui $S=\{m_0,m_1,\dotsc,m_k\}$ una sèrie temporal, $M$ una sèrie
temporal multiresolució i $e = \{ (\delta_0,f_0,\tau_0,k_0), \ldots,
(\delta_d,f_d,\tau_d,k_d)\}$ els paràmetres de l'esquema de
multiresolució de $M$ (\seeref{def:sgstm:esquema}). 

Primer, s'afegeixen totes les mesures de la sèrie temporal a la sèrie temporal
multiresolució, $\forall m \in S:$
\[
M_0=\glssymbol{addM}(M,m_0),M_1=\glssymbol{addM}(M_0,m_1),\dotsc,M_k=\glssymbol{addM}(M_{k-1},m_k)
\]

Segon, es consolida la sèrie temporal multiresolució fins que no sigui
consolidable (\seeref{def:model:buffer_consolidable}), sigui
$c\in\glssymbol{not:N}:$
\[
M'_0=\glssymbol{consolidaM}(M_k),\dotsc,M'_{c}=\glssymbol{consolidaM}(M'_{c-1}),M'=\glssymbol{consolidaM}(M'_{c})
\]
on $M_k,M'_{0},\dotsc,M'_{c-1},M'_{c}$ són consolidables i $M'$ no és
consolidable.  

Tercer, es consulta la sèrie temporal multiresolució amb les dues
consultes bàsiques definides a \textref{sec:sgstm:consultes}, les
quals retornen les sèries temporals
$S'=\glssymbol{not:sgstm:serietotal}(M')$ i $S_{\delta
  f}'=\glssymbol{not:sgstm:seriedisc}(M',\delta,f)$; on $\delta$ i $f$
són dos paràmetres de l'esquema de multiresolució de $M$ que estan
associats als altres dos paràmetres $\tau$ i $k$ de la resolució.  Hi
ha una $S_{\delta f}'$ possible per a cada paràmetre de l'esquema
$(\delta,f,\tau,k) \in e$.



En aquest context, formulem les funcions de transformació que permeten
calcular les sèries temporals consultades a partir de la sèrie
temporal original. Són dues funcions de multiresolució, a les
quals anomenem mapa de multiresolució ($\glssymbol{not:sgstm:dmap}$) i
plec de multiresolució ($\glssymbol{not:sgstm:multiresolucio}$), que
permeten calcular
\[
\glssymbol{not:sgstm:dmap}: S \times \delta \times f \times \tau \times k \longrightarrow
S'_{\delta f}
\]
\[
 \glssymbol{not:sgstm:multiresolucio}: S \times e  \longrightarrow S'
\]


és a dir de manera funcionalment equivalent, en computació diferida, a

\[
\glssymbol{not:sgstm:seriedisc}(M',\delta,f) \equiv
\glssymbol{not:sgstm:dmap}(S,\delta,f,\tau,k)
\]
\[
\glssymbol{not:sgstm:serietotal}(M') \equiv \glssymbol{not:sgstm:multiresolucio}(S,e)
\]


En resum. Primer, s'insereixen les mateixes mesures a un \gls{SGST} i
a un \gls{SGSTM}. Després, en temps diferit: per una banda es
consolida el \gls{SGSTM} i es consulta la sèrie total i el conjunt de
subsèries resolució emmagatzemades en els disc; per altra banda es
calcula en el \gls{SGST} l'operació de
$\glssymbol{not:sgstm:multiresolucio}$ i el conjunt d'operacions
possibles de $\glssymbol{not:sgstm:dmap}$. Aleshores s'obtenen,
respectivament, la mateixa sèrie temporal i el mateix conjunt de
subsèries temporals.





\subsection{Definicions}

En primer lloc, definim el comportament de la consulta de selecció de disc
dels \gls{SGSTM} mitjançant l'operador de mapa dels \gls{SGST}
(\seeref{def:sgst:mapa}).


\begin{definition}[mapa de multiresolució, 
amb comportament de \glssymbol{not:sgstm:seriedisc}]
Sigui $S$ una sèrie temporal, $M$ una sèrie temporal multiresolució,
$e$ l'esquema de multiresolució de $M$, i $(\delta,f,\tau,k)\in e$
un dels paràmetres de l'esquema. L'expressió de
$\glssymbol{not:sgstm:seriedisc}(M',\delta,f)$ com a mapa d'una sèrie
temporal és $\glssymboldef{not:sgstm:dmap}(S,\delta,f,\tau,k)=
\glssymbol{not:sgst:map}(S_I,\glssymbol{not:sgst:fmap})$ on
  \[
  \glssymbol{not:sgst:fmap}: m_i\mapsto f(S, [T(m_i)-\delta,T(m_i)]),
  \]
  \[
  S_I = \{ (t,\infty) | t\in T_I  \},\;  t_M = T(\max(S)),
  \]
  \[
  T_I = \{ t_I = \tau+n\delta | n\in\glssymbol{not:Z}\; \glssymbol{not:wedge}\; t_M - k\delta <
  t_I \leq t_M \}.
  \]
\end{definition}




En segon lloc, definim el comportament de la consulta de sèrie
temporal total dels \gls{SGSTM} mitjançant l'operador de plec amb
ordre dels \gls{SGST} (\seeref{def:sgst:oplec}).


\begin{definition}[plec de multiresolució, amb comportament de 
  \glssymbol{not:sgstm:serietotal}]
  Sigui $S$ una sèrie temporal, $M$ una sèrie temporal multiresolució
  i $e = \{ (\delta_0,f_0,\tau_0,k_0), \ldots,
  (\delta_d,f_d,\tau_d,k_d)\}$ l'esquema de multiresolució de $M$.
  L'expressió de $\glssymbol{not:sgstm:serietotal}(M)$ com a plec
  d'una sèrie temporal és
  $\glssymboldef{not:sgstm:multiresolucio}(S,e)=
  \glssymbol{not:sgst:ofold}(e,\{\},\glssymbol{not:sgst:ffold},\min)$
  on 
  \[
  \glssymbol{not:sgst:ffold}: S_i \times (\delta_c,f_c,\tau_c,k_c)
  \mapsto S_i ||
  \glssymbol{not:sgstm:dmap}(S,\delta_c,f_c,\tau_c,k_c).
  \]
  
  Així, el plec de multiresolució és la concatenació de tots els
  \glssymbol{not:sgstm:dmap} possibles per l'esquema $e$. De la
  mateixa manera que a \textref{def:sgstm:total}, s'ha d'assumir que
  $e$ no conté $\delta$ repetits i que els concatenem per odre de
  $\delta$. A més, noteu que en l'operació de plec tractem l'esquema
  $e$ com una sèrie temporal multivaluada.

\end{definition}





\subsection{Exemples}

Vegem en dos exemples el càlcul de la funció de multiresolució.
Utilitzem la funció d'agregació d'atributs \glssymbol{not:sgstm:maxpd}
segons \textref{def:sgstm:maxpd}.


\begin{example}[Mapa de multiresolució]
  \label{ex:multiresolucio:dmap}
  Sigui la sèrie temporal $S=\{(1,0),(3,1),(6,0),(10,1)\}$ i els
  paràmetres de multiresolució
  $(\delta_0=5,f_0=\glssymbol{not:sgstm:maxpd},\tau_0=0,k_0=2)$.  El
  mapa de multiresolució resulta en la sèrie temporal
  $S_{5\glssymbol{not:sgstm:maxpd}}'=
  \glssymboldef{not:sgstm:dmap}(S,5,\glssymbol{not:sgstm:maxpd},0,2)$
  on $S'_{5\glssymbol{not:sgstm:maxpd}}=\{(5,1),(10,1)\}$. A
  continuació expressem aquest càlcul pas a pas, a la
  \autoref{fig:multiresolucio:dmap} es visualitzen en taula les sèries
  temporals corresponents:
  \begin{enumerate}
  \item El primer pas és obtenir els instants de temps que
    s'emmagatzemarien al disc d'una sèrie temporal
    multiresolució. Així, els instants de consolidació possibles són
    $T_I'=\{\tau+n\delta|n\in\glssymbol{not:Z}\}=
    \{\ldots,-5,0,5,10,15,\ldots\}$. Però un cop consolidat el disc
    només hi haurà els $k=2$ més recents abans de $t_M=T(\max(S))=10$,
    és a dir $T_I=\{t_I\in T_I'|t_M - k\delta < t_I \leq
    t_M\}=\{5,10\}$.

  \item El segon pas és obtenir a partir de $T_I$ la sèrie temporal
    $S_I$ que es correspon amb la sèrie temporal que s'inicialitzaria
    al disc encara amb valors desconeguts,
    $S_I=\{(5,\infty),(10,\infty)\}$.



  \item El tercer pas és calcular la funció d'agregació a $S$ per a
    cada intervals de consolidació del disc de la forma
    $[T(m_i)-\delta,T(m_i)]$ on $m_i\in S_i$, és a dir $f(S,[0,5])$ i
    $f(S,[5,10])$. A tal efecte utilitzem el mapa sobre $S_I$ per a
    calcular la sèrie temporal resultant
    $S'_{5\glssymbol{not:sgstm:maxpd}}=\{ (5,f(S,[0,5])),
    (10,f(S,[5,10])) \}$, en què $f=\glssymbol{not:sgstm:maxpd}$ i per
    tant resulta en els valors ja expressats
    $S'_{5\glssymbol{not:sgstm:maxpd}}=\{(5,1),(10,1)\}$.

    Es pot calcular un pas entremig per tal de mostrar les sèries
    temporals que hi hauria en el buffer abans de cada instant de
    consolidació. Així, per a cada $T(m_i)$ hi hauria la sèrie
    temporal $S[T(m_i)-\delta,T(m_i)]$, és a dir $S_B=\{
    (5,S[0,5],(10,S[5,10]) \}=\{ (5,\{(1,0),(3,1)\}),
    (10,\{(5,0),(10,1)\})\}$.
  \end{enumerate}



\begin{figure}[tp]
  \centering
  \begin{tabular}[c]{|c|c|}
    \multicolumn{2}{c}{$S$} \\ \hline
    $t$  & $v$ \\ \hline
    1  & 0 \\
    3  & 1 \\
    6  & 0 \\
    10  & 1 \\ \hline
  \end{tabular} \qquad
  \begin{tabular}[c]{|c|c|}
    \multicolumn{2}{c}{$S_I$} \\ \hline
    $t$  & $v$ \\ \hline
    5  & $\infty$ \\
    10  & $\infty$ \\ \hline
  \end{tabular} \qquad
  \begin{tabular}[c]{|c|c|}
    \multicolumn{2}{c}{$S_B$} \\ \hline 
    $t$  & $v$ \\ \hline
    5  &  \raisebox{0pt}[1ex+\height][1ex+\depth]{\begin{tabular}[c]{|c|c|}\hline $t$  & $v$ \\ \hline 1&0\\ 3&1 \\\hline  \end{tabular}} \\\hline
    10  & \raisebox{0pt}[1ex+\height][1ex+\depth]{\begin{tabular}[c]{|c|c|}\hline $t$  & $v$ \\ \hline 6&0\\ 10&1 \\\hline  \end{tabular}} \\ \hline
  \end{tabular} \qquad
 \begin{tabular}[c]{|c|c|}
    \multicolumn{2}{c}{$S'_{5\glssymbol{not:sgstm:maxpd}}$} \\ \hline
    $t$  & $v$ \\ \hline
    5  & 1 \\
    10  & 1\\ \hline
  \end{tabular}
  \caption{Taules de les sèries temporals per l'operació \glssymbol{not:sgstm:dmap}}
  \label{fig:multiresolucio:dmap}
\end{figure}
 
\end{example}

\begin{example}[Plec de multiresolució]
  Sigui la sèrie temporal $S=\{(1,0),(3,1),(6,0),(10,1)\}$ i l'esquema
  de multiresolució
  $e=\{(\delta_0=5,f_0=\glssymbol{not:sgstm:maxpd},\tau_0=0,k_0=2),
  (\delta_1=2,f_1=\glssymbol{not:sgstm:maxpd},\tau_1=0,k_1=3)\}$.  El
  plec de multiresolució resulta en la sèrie temporal $S'=
  \glssymboldef{not:sgstm:multiresolucio}(S,e)$ on
  $S'=\{(5,1),(6,0),(8,0),(10,1)\}$. A continuació expressem aquest
  càlcul pas a pas, a la \autoref{fig:multiresolucio:multiresolucio}
  es visualitzen en taula les sèries temporals corresponents:

  \begin{enumerate}
  \item En primer lloc es calcula la sèrie temporal pels paràmetres de
    multiresolució $\delta_0$:
    $S_{D0}=\glssymbol{not:sgstm:dmap}(5,\glssymbol{not:sgstm:maxpd},0,2)=\{(5,1),(10,1)\}$,
    com ja s'ha vist a l'\autoref{ex:multiresolucio:dmap}.

  \item En segon lloc, es calcula la sèrie temporal pels paràmetres de
    multiresolució $\delta_1$:
    $S_{D1}=\glssymbol{not:sgstm:dmap}(2,\glssymbol{not:sgstm:maxpd},0,3)=\{(6,0),(8,0),(10,1)\}$,
    de manera similar a com s'ha calculat $S_{D0}$.

  \item En tercer lloc es concatenen les sèries temporals per ordre de
    $\delta$: $\delta_1<\delta_0$. Així, $S'= S_{D1} || S_{D0}$ que
    resulta en els valors ja expressats
    $S'=\{(5,1),(6,0),(8,0),(10,1)\}$ .

  \end{enumerate}
  


\begin{figure}[tp]
  \centering
  \begin{tabular}[c]{|c|c|}
    \multicolumn{2}{c}{$S$} \\ \hline
    $t$  & $v$ \\ \hline
    1  & 0 \\
    3  & 1 \\
    6  & 0 \\
    10  & 1 \\ \hline
  \end{tabular} \qquad
  \begin{tabular}[c]{|c|c|}
    \multicolumn{2}{c}{$S_{D1}$} \\ \hline
    $t$  & $v$ \\ \hline
    5  & 1 \\
    10  & 1 \\ \hline
  \end{tabular} \qquad
  \begin{tabular}[c]{|c|c|}
    \multicolumn{2}{c}{$S_{D2}$} \\ \hline
    $t$  & $v$ \\ \hline
    6  & 0 \\
    8  & 0 \\
    10  & 1 \\ \hline
  \end{tabular} \qquad
  \begin{tabular}[c]{|c|c|}
    \multicolumn{2}{c}{$S'$} \\ \hline
    $t$  & $v$ \\ \hline
    5  & 1 \\
    6  & 0 \\
    8  & 0 \\
    10  & 1 \\ \hline
  \end{tabular}
  \caption{Taules de les sèries temporals per l'operació \glssymbol{not:sgstm:multiresolucio}}
  \label{fig:multiresolucio:multiresolucio}
\end{figure}
 


\end{example}








\subsection{Demostració}

Cal demostrar l'equivalència formalment de \todo{demostrar}


\[
\glssymbol{not:sgstm:seriedisc}(M',\delta,f) \equiv
\glssymbol{not:sgstm:dmap}(S,\delta,f,\tau,k)
\]
\[
\glssymbol{not:sgstm:serietotal}(M') \equiv \glssymbol{not:sgstm:multiresolucio}(S,e)
\]












\chapter{Sistemes duals SGST+SGSTM}
\label{sec:multiresolucio:dual}

\todo{revisar}

\todo{alerta que s'han canviar els noms de mapa i plec de multiresolució}


Una sèrie temporal es pot emmagatzemar i gestionar en un \gls{SGST} o
en un \gls{SGSTM}. També es pot plantejar un sistema dual de
multiresolució on una sèrie temporal es tracti alhora en un \gls{SGST}
i en un \gls{SGSTM}.

Les equivalències entre els \gls{SGSTM} i les funcions de
multiresolució aplicades a un \gls{SGST} permeten dissenyar sistemes
duals que tinguin propietats complementàries.  Així, aquests sistemes
duals ofereixen altres utilitats a la multiresolució més enllà de
l'orientació de compressió amb pèrdua mostrada a la secció??\todo{ref
  model sgstm}. A continuació:
\begin{itemize}
\item Dissenyem l'estructura d'aquests sistemes duals
\item Avaluem conceptes relacionats en l'àmbit genèric dels \gls{SGBD}
\item Mostrem les aplicacions que permeten
\end{itemize}




\subsection{Estructura}

Un sistema dual de multiresolució està format per un \gls{SGST} i un
\gls{SGSTM} on s'emmagatzemen les mateixes sèries temporals. A
cadascun s'hi pot fer les consultes pertinents de cada model per a les
sèries temporal. A més, s'obté el mateix resultat en els dos sistemes
per a les consultes que segueixin les restriccions de la funció de
multiresolució.


A la \autoref{fig:multiresolucio:dual} es mostra l'estructura d'un
sistema dual de multiresolució. L'usuari percep aquest sistema com un
\gls{SGST} on emmagatzema una sèrie temporal $S$ i hi gestiona les
consultes, on algunes d'aquestes consultes són de multiresolució o
treballen sobre sèries temporals $S'$ que provenen de la
multiresolució.  Internament hi ha un \gls{SGST} i un \gls{SGSTM} que
comparteixen l'entrada de mesures de la sèrie temporal. Així, quan
l'usuari so\l.licita la multiresolució $S'$, el sistema dual tant pot
calcular-la a partir del \gls{SGST} amb l'operació de
$\glssymbol{not:sgstm:multiresolucio}(S)$ com a partir del \gls{SGSTM}
amb l'operació de $\glssymbol{not:sgstm:serietotal}(M)$.  La mateixa
estructura també pot servir per al cas de les operacions de
$\glssymbol{not:sgstm:dmap}$ i les de
$\glssymbol{not:sgstm:seriedisc}$.


\begin{figure}
  \centering
  \input{imatges/multiresolucio/sgst-m-dual.tex}
  \caption{Sistema dual de multiresolució: \gls{SGST}+\gls{SGSTM}}
  \label{fig:multiresolucio:dual}
\end{figure}


Cal comentar que el model de \gls{SGSTM} està dissenyat en base al
model de \gls{SGST} i per tant aquests primers sempre depenen dels
segons. No obstant això, cal no confondre aquesta dependència amb el
sistema dual, el qual gestiona una mateixa sèrie temporal independentment
en un \gls{SGSTM} i en un \gls{SGST}.




Tot i que per al sistema dual és equivalent calcular la sèrie temporal
resultant a partir del \gls{SGST} o del \gls{SGSTM}, no pot seguir el
mateix procediment en cada cas. Per una banda, la
$\glssymbol{not:sgstm:multiresolucio}(S)$ és una operació computada en
temps diferit; cada cop que s'afegeix una nova mesura cal tornar a
calcular tot el resultat. Per altra banda, la
$\glssymbol{not:sgstm:serietotal}(M)$ és una operació computada en
línia; és a dir seguint el flux d'adicions de les mesures.


El sistema dual dissenyat funciona a partir de l'adició de mesures, de
la mateixa manera que els \gls{SGSTM}. L'ordre d'arribada d'aquestes
mesures és crític en el sistema dual ja que un cop el \gls{SGSTM} s'ha
consolidat les dades més antigues que arribin no seran tingudes en
compte i per tant l'equivalència entre les consultes de \gls{SGST} i
\gls{SGSTM} ja no serà certa. Així doncs, si es vol mantenir
l'equivalència, el sistema dual dissenyat té aquestes dues
restriccions: només permet operacions d'adició i l'ordre d'adició és
important.  Més endavant a les aplicacions descriurem l'abast
d'aquestes restriccions.



\todo{potser algun lloc hauria d'aparèixer que els buffers del sgstm podem treballar amb les mesures emmagatzemades al sgst, és a dir que no és que calgui emmagatzemar dosc cops el mateix}



\subsection{Conceptes relacionats}


\textcite{marz13:nosql13, marz14:bigdata} generalitzen un concepte
similar al de \gls{SGST} dual, ho emmarquen en l'àmbit dels \gls{SGBD}
per a \emph{Big Data}.  Proposen \gls{SGBD} dissenyats amb tres
nivells, que anomenen arquitectura \emph{Lambda}:
\begin{itemize}
\item Nivell \emph{batch}: Emmagatzema totes les dades originals i
  permet realitzar qualsevol consulta sobre aquestes dades. Preveu que
  algunes consultes operen sobre dades consultades prèviament, per
  tant en aquest nivell es gestionen també aquestes consultes
  precomputades, les quals a més es poden obtenir amb computació
  para\l.lela com per exemple amb Hadoop. Particularment, es considera
  que les dades originals són immutables, és a dir que les bases de
  dades només permeten afegir però no modificar.

\item Nivell \emph{server}: Emmagatzema les consultes precomputades i
  n'ofereix les dades per a altres consultes. Les consultes
  precomputades s'han de tornar a calcular periòdicament i en el
  nivell \emph{server} sempre hi ha la versió calculada més
  recent. Per tant, es preveu que les consultes precomputades no
  ofereixen la informació actualitzada al moment, sinó que hi ha un
  cert temps des que es modifiquen les dades originals fins que té
  impacte en les consultes.

\item Nivell \emph{speed}: Precomputa les mateixes consultes que el
  nivell \emph{batch} però incrementalment, és a dir cada cop que
  s'afegeix una dada nova les dades de la consulta \emph{speed}
  s'actualitzen adequadament.  Aquest nivell només s'usa per a dades
  recents per tal complementar el problema de les dades
  desactualitzades en els nivells \emph{batch} i \emph{server}.
\end{itemize}


Les consultes precomputades d'aquests sistemes semblen una bona
solució per a la computació de les vistes dels \gls{SGBDR} \todo{ref a art sgbd}.  Una vista
és un àlies per a una expressió relacional, és a dir una consulta, que
s'utilitza en altres consultes. Per tant, una vista $v$ és una
operació $\text{op1}$ sobre unes $\text{dades}$,
$v:=\text{op1}(\text{dades})$, i s'utilitza una altra consulta
$\text{op2}(v)$ de manera que és equivalent a executar la consulta
$\text{op2}(\text{op1}(\text{dades}))$. Així doncs, el model de vistes
és similar a les consultes que es basen en altres consultes proposat
per \citeauthor{marz14:bigdata} o a les sèries temporals precomputades
que proposem.


En el model relacional \cite[cap.~10. Views]{date04:introduction8} es
considera, conceptualment, que les vistes no s'avaluen quan es
defineixen sinó cada cop que s'executa una consulta que hi opera.  En
les implementacions les vistes poden ser precomputades, aleshores
s'anomenen \emph{snapshots} o \emph{materialized views}, per tal
d'aconseguir un emmagatzematge temporal dels mateixos càlculs per a
diverses consultes. En el context de sistemes de suport a les
decisions, la precomputació també es preveu en el càlcul de taules
resum per a agregacions de les dades \cite[cap.~22. Decision
support]{date04:introduction8}.  Això no obstant, la precomputació de
vistes no sempre comporta una millor eficiència; el concepte de vista
del model permet la substitució algebraica i per tant permet
l'optimització global de la consulta i l'operació continguda a la
vista.



% PostgreSQL no té materialized views però aquí expliquen com definir-ne a partir de triggers. \url{http://tech.jonathangardner.net/wiki/PostgreSQL/Materialized_Views}.





Les vistes precomputades tenen associada una acció per actualitzar de
nou el seu valor, és a dir per a recalcular la consulta que contenen
quan les dades originals han canviat. En usar vistes precomputades cal
preveure el termini de validesa dels càlculs precomputats, com ocorre
en el nivell \emph{server} de l'arquitectura \emph{Lambda}. Així
doncs, les vistes precomputades es poden actualitzar de vàries
maneres:
\begin{itemize}

\item L'usuari decideix manualment quan s'han de tornar a computar. Per
  exemple, per a treballar durant un cert temps amb còpies immutables
  de les dades (\emph{snapshots}) sense haver de blocar la modificació
  de la base de dades \cite[\S{}10.5]{date04:introduction8}.

\item Es computen periòdicament, com també es proposa en el nivell
  \emph{batch} de l'arquitectura \emph{Lambda}.

\item Quan s'utilitzen per primer cop, es computen associades a un
  temps de termini a partir del qual si es tornen a utilitzar s'hauran
  de tornar a computar. 


\item Es computen cada cop que es modifiquen les dades amb les quals
  operen, és a dir quan les dades originals reben una operació
  d'afegir, de modificar o d'actualitzar es torna a computar tota la
  vista.

\item Quan es modifiquen les dades, s'aplica la mateixa operació a la
  vista precomputada; requereix especificar la instrucció
  d'actualització. És a dir, quan es modifiquen les dades originals
  amb una operació, $\text{mod}(\text{dades})$, es trasllada aquesta
  operació a la vista, $\text{mod}'(\text{dades})$, on cal determinar
  la relació entre $\text{mod}$ i $\text{mod}'$.  Aquesta translació
  és més senzilla quan només hi ha possibilitat d'operacions d'afegir
  noves dades però no de modificar-les: és el que es proposa en el
  nivell \emph{speed} de l'arquitectura \emph{Lambda} i el que admet
  el model de \gls{SGSTM} que proposem. \textcite{jagadish95} també proposen
  una solució semblant de mantenir vistes incrementalment segons
  arriben les dades amb un estudi proper al \emph{data stream}.
\todo{s'ha d'estudiar la
    relació d'això amb els data stream}
% When data comes as an ordered sequence of instances it is called
% data stream, then specific \acro{DBMS} are designed to manage data
% stream data \cite{stonebraker05:sigmod}.  \acro{MTSMS} can take
% advantage of data stream orientation in order to simplify the
% consolidation process.  Assuming a time order acquisition of time
% series, the update of a \acro{MTSMS} only consists in the addition of
% new measures and the incremental consolidation of subseries. 
\end{itemize}



En resum, la sèrie temporal resultant dels sistemes duals pot ser
considerada com una vista calculada sobre les sèries temporals
originals. Aquesta vista pot ser precomputada, cosa que es pot fer de
diverses maneres: la funció de multiresolució l'ha de computar
totalment cada cop que s'afegeix una nova mesura i en canvi els
\gls{SGSTM} la computen incrementalment.  Aleshores aquestes vistes es
poden usar per a altres consultes que tinguin com a context
l'aproximació de multiresolució realitzada, o per a visualitzacions
gràfiques com les que ofereix RRDtool \cite{rrdtool}.






%Estudiar també Aurora
%http://www.cs.brown.edu/research/aurora/vldb03_journal.pdf
% Abadi, D., Carney, D., Cetintemel, U., Cherniack, M., Convey, C., Lee, S., Stonebraker, M., Tatbul, N., and Zdonik, S. Aurora: A New Model and Architecture for Data Stream Management. In VLDB Journal (12)2:120-139, August 2003.





\subsection{Aplicacions}


Les sèries temporals són dades que s'adquireixen contínuament i per
tant cada cop és més gran el volum de dades que s'ha d'emmagatzemar i
tractar. Aquest gran volum de dades és un problema per a operar amb
les sèries temporals i és un problema en els sistemes que tenen
l'emmagatzematge limitat. En aquest sentit, originalment hem
plantejat el model de \gls{SGSTM} per tal d'oferir una solució
d'emmagatzematge que comprimeix la informació seleccionant-ne una
multiresolució determinada.


Així, un \gls{SGSTM} implica un selecció d'informació i la informació
que no es considera importat és descartada. Aquests sistemes, per
tant, no són adequats quan totes les dades monitorades han de ser
emmagatzemades tal com s'adquireixen. Un cas d'aquests és quan no es
coneixen quines funcions d'agregació són les més escaients per a les
dades futures que s'adquiriran. Un altre cas és quan volem resoldre
consultes detallades sobre les dades, com per exemple: a quina hora
exacta ha ocorregut un esdeveniment.


Els sistemes duals de multiresolució ofereixen una solució per
emmagatzemar totes les dades però mantenint-ne una gestió de
multiresolució.  En el sistema dual, s'ha d'entendre el \gls{SGST} com
un emmagatzematge a llarg termini que no és consultat freqüentment;
així pot estar implementat com a \gls{SGBD} per a dades de gran volum
i basat en tècniques de compressió sense pèrdua, encara que tinguin
temps grans de descompressió. El \gls{SGSTM} s'ha d'entendre com un
emmagatzematge de compressió amb pèrdua que conté multiresolucions
precomputades de la sèries temporal.  El temps de còmput no és tant
crític en els \gls{SGSTM} perquè es reparteix al llarg del temps, és a
dir tal com es van adquirint les dades; més enllà del temps de còmput
de cada funció d'agregació d'atributs, el qual limita la quantitat de
multiresolucions diferents que pot gestionar un mateix \gls{SGSTM}.


En la compressió de dades multimèdia s'utilitza una tècnica de gestió
similar.  Les dades s'emmagatzemen inicialment amb compressió sense
pèrdua, a partir d'aquestes es generen dades amb compressió amb pèrdua
que ocupen menys i són més àgils per a treballar. En el cas que calgui
modificar les dades, es canvien les comprimides sense pèrdua i es
regeneren de nou comprimides amb pèrdua. Amb aquesta gestió s'evita el
problema que les compressions amb pèrdua acumulin pèrdua entre
successives modificacions.  \todo{citació?}



En resum, les aplicacions del sistema dual de multiresolució són les
següents:
\begin{itemize}
\item Sistemes on els \gls{SGSTM} precomputen en flux vistes que són
  consultes de multiresolució. És a dir, funcionen com a precomputació
  de consultes que es preveuen que es faran; per tant al llarg del
  temps es creen i eliminen vistes segons les necessitats que es
  preveuen. Aleshores els \gls{SGST} funcionen com a emmagatzematge a
  llarg termini que es consulta rarament.


\item Les dades emmagatzemades en els \gls{SGST} s'utilitzen per al
  farciment inicial dels \gls{SGSTM} gràcies a la funció de
  multiresolució que permet computar les sèries temporals dels discs a
  partir de l'operació \glssymbol{not:sgstm:dmap}. Pot tenir diversos
  objectius:
  \begin{itemize}
  \item Quan es creen les vistes precomputades anteriors, inicialment
    el \gls{SGSTM} contindrà sèries temporals amb valors desconeguts;
    amb la funció de multiresolució es poden inicialitzar amb els
    valors correctes.

  \item Es pot usar per a canviar l'esquema de multiresolució dels
    \gls{SGSTM}. En alguns canvis d'esquema, per exemple ampliar un
    disc, inicialment hi ha dades desconegudes però que es poden
    computar amb la funció de multiresolució.

  \item Es pot usar per a canviar d'un emmagatzematge de sèries
    temporals en \gls{SGST} a un emmagatzematge en \gls{SGSTM}. Cal
    notar que és un canvi irreversible perquè l'emmagatzematge en els
    \gls{SGSTM} és amb pèrdua.
  \end{itemize}

\item Es poden usar els \gls{SGST} per a experimentar amb diversos
  esquemes de multiresolució per a les dades adquirides i així
  observar-ne la idoneïtat i escollir-ne un de millor.

\item En el cas que no es compleixi la restricció d'ordre d'arribada
  de les mesures per a l'equivalència entre els \gls{SGST} i els
  \gls{SGSTM}, es podria refer la informació emmagatzemada en els
  \gls{SGSTM} a partir dels \gls{SGST}.

\end{itemize}


Com a contrapartida, però, en els sistemes duals apareix un \gls{SGST}
amb una gran quantitat de dades. Per tant, cal tenir en compte que si
la informació computada pels \gls{SGSTM} és suficient per a les
consultes que s'han de realitzar, aleshores la informació
emmagatzemada en els \gls{SGST} és redundant. Això no obstant, no és
senzill identificar i predir quan la informació emmagatzemada en el
\gls{SGSTM} serà totalment suficient.
\todo{a la secció de la
  teoria de la informació descriurem el problema d'identificar la
  informació que seleccionem i la que perdem i per tant podríem predir
  quan la tenim redundant?? }



En conclusió, encara que l'objectiu final sigui l'emmagatzematge de
les sèries temporals comprimides amb pèrdua en un \gls{SGSTM}, és a
dir el model proposat originalment, els sistemes duals de
multiresolució es poden utilitzar mentre hi hagi dubtes sobre quin
esquema de multiresolució escollir i eliminar-los un cop es consideri
que l'esquema és correcte. Aleshores, l'estructura de sistema dual
serveix per a observar clarament que els \gls{SGSTM} ofereixen una
sèrie temporal $S'$ que és una aproximació a una certa informació que
hi ha en l'original $S$ i que, per tant, permeten resoldre consultes
aproximades. %
La \autoref{fig:multiresolucio:comparacio-propietats} resumeix les
propietats descrites dels \gls{SGST}, dels \gls{SGSTM} i dels
\gls{SGST}+\gls{SGSTM}, on es comparen segons si les compleixen (S) o
si no les compleixen (N).


\begin{table}[tp]
  \centering
  \begin{tabular}[c]{r|ccc}
  & \gls{SGST} & \gls{SGSTM} & \gls{SGST}+\gls{SGSTM}\\\hline
  càlcul de la multiresolució & S & S & S \\
  emmagatzematge comprimit i limitat & N & S & N+S\\
  pèrdua de dades & N & S & N\\
  redundància de dades & N & N & S\\ 
  actualització de la multiresolució & S & N & S\\
  precomputacions en flux & N & S & S\\
  precomputacions en para\l.lel & S & N & S\\
\end{tabular}
  \caption{Comparació de les propietats dels \gls{SGST}, dels \gls{SGSTM} i dels \gls{SGST}+\gls{SGSTM}}
  \label{fig:multiresolucio:comparacio-propietats}
\end{table}











%%% Local Variables:
%%% TeX-master: "main"
%%% End:


%  LocalWords:  multiresolució multiresolucions subsèries SGST SGSTM
