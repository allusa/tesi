
\section{Model}

\todo{Definicions que cal tenir:}

* \acro{MTSMS}
* \acro{MTSM}
* time series representation
* time series pathologies


La definició del model s'estructura en dues parts:

\begin{itemize}
\item Un model pels (SGST)  que defineix mesura i sèrie temporals.
\item Un model pels (SGSTM) que defineix buffer, disc i subsèrie
  resolució, el qual treballa sobre el model de SGST.
\end{itemize}

\todo{sobre tres nivells}
A l'estat de l'art s'ha d'haver explicat els tres nivell de model de dades segons Date i deixar clar aquí que nosaltres definim un model pel segon nivell: nivell de model lògic. Els models lògics modelen les dades, en canvi els models conceptuals modelen la realitat, Fabian Pascal posa d'exemple conceptual el model E/RM.


Objectius:

En el model de SGST s'observen algunes patologies que poden presentar les sèries temporals. El model de SGSTM soluciona algunes d'aquestes patologies:

\begin{itemize}
\item Regularitza les sèries temporals
\item Tracta i validar les sèries temporals: gestiona els casos de dades errònies o desconegudes i marca quan hi ha valors erronis.
\item És una solució de compressió per a quantitats enormes de dades
\end{itemize}


Però el model de SGSTM també es pot fer servir per altres aplicacions:

* Regularitzar en línia (temps real) una sèrie temporal en diferents períodes de mostreig

* Tenir unes vistes (consultes) a punt (ja processades) amb diferents resolucions d'una sèrie temporal

* Comprimir per decimació (downsampling) o bé farcir forats (reconstrucció del senyal)


Dir que és interessant complementar els TSMS i MTSMS amb altra informació (localització del sensor, unitats del valors, etc.) però que aquesta informació és millor guardar-la en un SGBD relacional.



\section{Time series preliminaries}
\label{sec:model:preliminaries}

\todo{vigilar que s'ha canviat l'ordre de les mesures a (t,v)}

\todo{sobretot explicar les tres visions de les sèries temporals: conjunt, seqüència i funció}

% In this section we introduce some background concepts and the
% nomenclature which we will use later.  First we define the main
% objects of a \acro{MTSMS} which are measures and time series.

% A \emph{measure} is a value measured in a time instant. More formally
% it is a tuple $(v,t)$ where $v$ is the value of the measure and $t \in
% \mathbb{R}$ is the time instant of measurement.  The values of a time
% series can be of any type. For simplicity examples are presented with
% integers or real numbers but can also be strings or vectors.  Let $m =
% (v,t)$ be a measure, $v$ is written as $V(m)$ and $t$ is written as
% $T(m)$.

% The time value defines the canonical order between measures.  Let $m =
% (v_m, t_m)$ and $n = (v_n, t_n)$ be two measures, then $m\geq n$ if
% and only if $t_m\geq t_n$.

% A \emph{time series} is sequence of measures of the same phenomena
% that are ordered in time.
% \begin{definition}[Time series]
%   A \emph{time series} $S$ is a a set of measures of the same
%   phenomena $S = \{m_0, \ldots, m_k\}$ without repeated time values
%   $\forall i,j: i\leq k, j\leq k, i\neq j : T(m_i)\neq T(m_j)$. Given
%   a time series $|S|$, we note its size by $|S|=k+1$. Observe that,
%   because measures in $S$ are of the same phenomena, the type of $S$
%   values is homogeneous.
% \end{definition}

% The order defined by measures implies a total order in a time
% series. As a time series is a finite set, if it is not empty it has a
% maximum and a minimum.  Let $S=\{m_0,\ldots,m_k\}$ be a time series
% and $n\in S$ be a measure. The time series' maximum is $n=\max(S)$ if
% and only if $\forall m \in S: n \geq m $.  Similarly, the time series'
% minimum is $n=\min(S)$ if and only if $\forall m \in S: n \leq m$.

% Given the order defined by time, in a time series we define the
% sequence interval following \cite{last:keogh,last:hetland}.  Let
% $S=\{m_0, \ldots, m_k\}$ be a time series. We define the subset
% $S(r,t] \subseteq S$ as the time series $S(r,t]=\{m\in S | r<T(m)\leq
% t\}$, where $r$ and $t$ are two instants in time.  We also define the
% subset $S(r,+\infty)\subseteq S$ as the time series $S(r,+\infty) =
% \{m\in S | r< T(m) \leq T(\max(S))\}$ and the subset
% $S(-\infty,t)\subseteq S$ as the time series $S(-\infty,t) = \{m\in S
% | T(\min(S))\leq T(m) < t\}$.

% The time order in time series also implies the sequence concept of
% next and previous measure.  Let $S=\{m_0, \ldots, m_k\}$ be a time
% series and $l\in S$ and $n$ be two measures. We define the next
% measure of $n$ in $S$ as $l=\nex_S(n)$ where $l =
% \min(S(T(n),+\infty))$. We define the previous measure of $n$ in $S$
% as $l=\prev_S(n)$ where $l = \max(S(-\infty,T(n)))$.

% Let $S$ be a time series, $t$ be a time instant and $\delta$ be a
% time duration, then the time series' measures can be located in the
% time interval $i_0=[t, t+\delta]$ and its multiples $i_j=[t+j\delta,
% t+(j+1)\delta]$ for $j=0,1,2,\ldots$. When time series' measures are
% equally spaced we say it to be regular.
% \begin{definition}[Regular time series]
%   Let $S=\{m_0,$ $ldots,$ $m_k\}$ be a time series and $\delta$ a time
%   duration. $S$ is regular if and only if $\forall m \in
%   S(T(\min(S),+\infty):T(m) - T(\prev_S(m)) = \delta$.
% \end{definition}



%Representation:
% In the design of the attribute aggregate function we can interpret a
% time series in different ways, that is what we call the representation
% of a time series. Keogh et al.\ \cite{last:keogh} cite
% some possible representations for time series such as Fourier
% transforms, wavelets, symbolic mappings or piecewise linear
% representation. The last one is very usual due to its simplicity,
% \cite{keogh01}.

% Time series representations can be taken into account when computing
% with the measures of the time series.  For example, a maximum
% attribute aggregate function may give different values if we consider
% a linear or a constant piecewise representation.

% Following we show a possible family of attribute aggregate functions
% for time series represented by a staircase function, that is with a
% piecewise constant representation.  We define a new representation for
% time series named \emph{zero-order hold backwards} (zohe). This
% representation holds back each value until the preceding value. 
% RRDtool, \cite{lisa98:oetiker}, has a similar aggregate function.

% Let $S=\{m_0,\ldots,m_k\}$ be a time series, we define
% $S(t)^{\text{zohe}}$ as its continuous representation along time $t$:
% $\forall t \in \mathbb{R} ,\forall m \in S:$
% \begin{equation}
%  S(t)^{\text{zohe}} =  
% \begin{cases}
%   \infty & \text{if } t > T(\max S) \\
%   V(m)   & \text{if } t\in (T(\prev_S m),T(m)]
% \end{cases}
% \label{eq:zohe}
% \end{equation}


\section{Multiresolution model}
\label{sec:MTSMS}

The \acro{MTSMS} are \acro{TSMS} that store time series with a lossy
compression approach, that is some information is selected and spread in
different time resolutions. The \acro{MTSMS} model is based on the
concepts of measures and time series as defined in
Section~\ref{sec:model:preliminaries}.


The multiresolution concept comes from thoroughly analysis of the
RRDtool \cite{rrdtool} \acro{TSMS}. Our objective is to formalise its
essential parts into an abstract model, where what we call
multiresolution plays a main role, and to include more genericity in
order to describe \acro{MTSMS} as fully \acro{TSMS}. Then we will be
able to apply these systems to other applications.
\todo{repassar paràgraf}


A \acro{MTSMS} stores multiresolution time series where each has a
multiresolution schema as shown in Figure~\ref{fig:model:mtsdb}. A
multiresolution time series is a collection of resolution subseries
which temporarily accumulate measures in a buffer in order to select
some information and finally store it in a disc. The information
selection process changes the time intervals between measures to
compact information by aggregating the time series attributes. 

\begin{figure}
  \centering
  \input{imatges/mtsms-arquitectura_interna.tex}
  %\smallskip
  \caption{Architecture of \acro{MTSMS} model}
  \label{fig:model:mtsdb}
\end{figure}


In this way, the original time series gets stored spread in the discs,
each with a different time resolution and attribute aggregation.
Discs are size bounded so they only contain a fixed amount of
measures. When a disc becomes full it discards a measure. Thus,
multiresolution database is bounded in size and the time series gets
stored in pieces, that is time subseries.

Regarding operations, \acro{MTSMS} structure needs operators to change
the time intervals between measures and to select attributes. Mainly,
these operators are measure additions and time series consolidations,
which some functionality is delegated to operators called attribute
aggregate functions. Secondarily, there are operators to query the
multiresolution schema and extract time series data.


Following we define the \acro{MTSMS} model by: (i) four basic
structure model elements ---buffer, disc, resolution subserie, and
multiresolution time series--- with its structure operators, (ii) the
operations to change and consult a multiresolution schema, and (iii)
the attribute aggregate functions.



\subsection{Structure}

A \emph{buffer} is a container for a regular or a no-regular time
series. The buffer objective is to regularise the time series using a
predetermined step and an attribute function. We name
\emph{consolidation} to this action.
\begin{definition}[Buffer]
  A \emph{buffer} is defined as the tuple $(S_B,\tau,\delta,f)$ where
  $S_B$ is a time series, $\tau$ is the last consolidation time,
  $\delta$ is the duration of the consolidation step and $f$ is an
  attribute aggregate function.

  An empty buffer $B_{\emptyset} = (\emptyset,t_0, \delta, f)$ has an
  empty time series, an initial consolidation time $t_0$ and
  predetermined $\delta$ and $f$.
\end{definition}

Operator \emph{addBuffer} adds a measure to its time series:
$\addB: B = (S_B,\tau,\delta,f) \times m \mapsto
(S'_B,\tau,\delta,f)$ where $S'_B = S \cup \{m\} $.

From the $B_{\emptyset}$ all the consolidation time instants can be
calculated as $t_0+i\delta, i\in\N$. The consolidation of $B$ in a
time interval $i=[\tau,\tau+\delta]$ results in a measure
$m'=f(S_B,i)$ where $f$ is an attribute aggregate function
$f$. Operator \emph{consolidateBuffer} consolidates a set of measures
and removes the consolidated part of the time series from the buffer:
$\consB : B=(S_B,\tau,\delta,f) \mapsto B' \times m'$ where $ B'=
(S'_B,\tau+\delta,\delta,f)$, $m' = f(S,[\tau,\tau+\delta])$, and
$S'_B$ is the discarding of historic data not needed anymore, for example
$S'_B = S[\tau+\delta,+\infty]$.

On a simplified way, the $\consB$ is only applied to the present
consolidation interval and the total consolidation is obtained by
successive application of the operator. This requires measures to be
added by time order and to consolidate the buffer when the time of
some measure is bigger than the buffer's next consolidation time.  Let
$B=(S_B,\tau,\delta,f)$ be a buffer and $m=\sup(S_B)$ the maximum
measure, $B$ is consolidable if and only if $T(m) \geq
\tau+\delta$.


A \emph{disc} is a finite capacity measures container. A time series
stored in a disc has its cardinal bounded. When the cardinal of the
time series is to overcome the limit, some measures need to be
discarded.
\begin{definition}[Disc]
  A \emph{disc} is a tuple $(S_D,k)$ where $S$ is a time series and
  $k\in\N$ is the maximum allowed cardinal of $S_D$.  An empty
  disc $D_{\emptyset} = (\emptyset,k)$ has an empty time series and
  the $k$ maximum cardinal allowed.
\end{definition}

The cardinal of the times series is kept under control by the add
operator, $\addD : D=(S_D,k)\times m\mapsto (S'_D,k)$ where %
$
 S_D' = \begin{cases}
  S_D\cup\{m\}                 & \text{if } |S_D|<k  \\
  (S_D-\{\min(S_D)\}) \cup \{m\} & \text{otherwise}
\end{cases}  
$.


A \emph{resolution subseries} is a structure that regularises and
aggregates a time series. It is composed of a buffer, that contains
the partial time series to be regularised, and a disc, that contains
the regularised time series.
\begin{definition}[Resolution subseries]
  A \emph{resolution subseries} is a tuple $(B,D)$ where $B$ is a
  buffer and $D$ is a disc.  An empty buffer and empty disc imply an
  empty resolution subseries $R_{\emptyset} =
  (B_{\emptyset},D_{\emptyset})$.
\end{definition}
 
The operators of a resolution subseries extend the buffer and disc
ones: (i) The addition of a measure to the buffer of the resolution
subseries: $\addR : R=(B,D) \times m \mapsto R'$ where $R'= (B',D)$,
and $B'= \addB(B,m)$; (ii) The consolidation of the resolution
subseries by consolidating its buffer and adding the consolidation
measure to its disc: $\consR : R=(B,D) \mapsto R'$ where $R'=
(B',D')$, $(B',m') = \consB(B)$, and $D'= \addD(D,m')$.  A resolution
subseries is consolidable only when its buffer is consolidable.




A \emph{multiresolution time series} is a set of resolution subseries
which share the input of measures, that is they buffer the same time
series. A time series is stored regularised and distributed with
different resolutions in the various resolution subseries, as
previously shown in Figure~\ref{fig:model:mtsdb}.
\begin{definition}[Multiresolution time series]
  A \emph{Mul\-ti\-re\-solution time series} is a set of resolution
  subseries $\{R_0, \dots, R_d\}$.  An empty multiresolution series
  has empty resolution subseries $M_{\emptyset}=\{R_{0_\emptyset},
  \dots, R_{d_\emptyset}\}$. Usually there are no repeated pairs of
  ($\delta_i$,$f_i$) among a multiresolution series, so they act as a
  key attributes.
\end{definition}

The operators of a multiresolution time series apply to every
resolution subseries contained: (i) The addition of a measure to every
resolution subseries: $\addM : M=\{R_0, \dots, R_d\} \times m \mapsto
\{R'_0, \dots, R'_d\}$ where $R'_i=\addR(R_i,m)$; (ii) The
consolidation of all resolution subseries: $\consM : M=\{R_0, \dots,
R_d\} \mapsto \{R'_0, \dots, R'_d\}$ where %
$ 
R'_i = \begin{cases}
  \consR(R_i) & \text{if } R_i \text{ consolidable} \\
  R_i                       & \text{otherwise}
\end{cases}
$.


The multiresolution consolidation operation should be applied
regularly based on a consolidation clock. When the measure ordered
addition approach is taken as explained in the buffer's consolidation,
then there is no need for a clock in a MTSMS. The consolidation clock
is induced by the measure's addition and then it is only necessary to
check the multiresolution consolidation operation on new
additions. However, there could be other approaches where the
consolidation clock was given by an external clock or external
events. Then the consolidable definitions would depend on this
external clock.


\todo{s'hauria de dir que cada R en una M es configura amb els parametres (delta,tau,f,k) si més no a data manipulation}


\subsection{Data manipulation}


\todo{tenim espai per a les operacions d'esquema? o potser deixar-ho per una altre article}



\subsection{Queries}


There are two basic time series queries for a MTSMS: (i) extract a
time subseries from a resolution subseries' disc or (ii) query for a
total time series from all consolidated information.

The first is a selection of a disc over a multiresolution time series,
being $(\delta,f)$ the key attributes: $\seriedisc:
M=\{R_0, \dots, R_d\} \times \delta \times f \mapsto S'_D$ where $S'_D
= ( (S_B',\tau',\delta,f) , (S_D',k') ) \in M$

The second is a concatenation of all discs' time subseries trying to
obtain the most resolution as possible, which is to say by $\delta$
order: $\totalseries: M*=\{R_0, \dots, R_d\} \mapsto S'$ where $S' =
S_{D0} || S_{D1} || \cdots || S_{Dd}$ and $\delta_0 < \delta_1 <
\cdots < \delta_d$. This states that $M*$ is a multiresolution time
subseries where $R_i$ have a total order by its attribute
$\delta_i$. Being $(\delta,f)$ the key attributes, the $M*$ can
be obtained from $M$ by selecting resolution subseries with same $f$. If we
operated a $\totalseries$ to a general $M$ then it could be ambiguous
as it could contain repeated $\delta_i$.


From these two basic time series queries, more elaborated queries can
be applied to MTSMS by using TSMS operations. For example, let $M_1$
and $M_2$ be two multiresolution time series, we can compute the sum
of both with $\totalseries(M_1) + \totalseries(M_2)$. 
% This is the general algebraic expressions that describes the model,
% but an implementation of the model could accomplish this operation
% in a more efficient way.





\subsection{Attribute aggregate function}
\label{sec:model:interpolador}

Attribute aggregate function are used when consolidating a buffer in
order to summarise the time series information. Let $S$ be a time
series and $t_0$ and $t_f$ two time instants, an attribute aggregate
function $f$ calculates a measure that summarises the measures of $S$
included in the time interval $i=[t_0,t_f]$:
\[
f : S=\{m_0,\ldots,m_k\} \times [t_0,t_f] \mapsto m'
\]
where, generally, $m'$ results from two operations on the time series:
(i) a time subseries selection $S'$ depending on the consolidating
interval, for example $S' = S[t_0,t_f]$, and (ii) an aggregation over
this time subseries $m' = \agg(S',m_i a)$ with $a: m_i \times
m\rightarrow m''$.  \todo{mirar be sintaxi agg}

To summarise a time series we can use different attribute aggregate
functions.  For instance, we can calculate an statistic indicator of
the time series such as the average or we can apply a more complex
digital signal processing operation, \cite{zhang11}. Furthermore, the
possible representation for a time series and some of its pathologies
can be considered during the aggregation process.


In conclusion, we can define many attribute aggregate functions and
thus no global assumptions can be made about them. Each user has to
decide which combination of aggregation and representation fits better
with the measured phenomena.  Therefore, \acro{MTSMS} must allow users to
define aggregate functions.

We can classify attribute aggregate functions based on a discrete or
continuous approach. For each approach we can define patterns that
explain how the resulting value $V(m')$ is calculated but not the
resulting time instant $T(m')$, which is subject to
interpretation.  


Regarding the resulting consolidation time, normally it will be
$T(m')=t_f$ to be consistent with the consolidation operation of a
buffer where $\tau' = \tau + \delta \equiv t_f$. However, as will be
shown below on some examples, $T(m')$ can have an offset with buffer
consolidating times. A trivial example of an offset is for an
aggregate function that returns the first measure
$m'=\min(S[t_0,t_f))$ as then $t_0 \leq T(m') < t_f$.


First, discrete aggregation functions are based on set and sequence
time series operators. The patterns of these functions leave $T(m')$
undefined as well as the time subseries consolidating interval, that
is the resulting measure can be aggregated from a time subseries $S'$
with open interval $S'=S(t_0,t_f)$, closed interval $S'=S[t_0,t_f]$,
or other combinations like $S'=S(t_0-d,t_f-d]$ where $d$ is a time
duration. Next there are some attribute patterns examples, let the
time be continuous on all the time domain $t\in T$:
\begin{itemize}
%\renewcommand{\labelitemi}{--}
\item maximum$^d$: $S \times i \mapsto m'$ where $V(m') =
  \max_{\forall m \in S'}(V(m))$. It summarises $S'$ with the maximum
  of the measure values.
\item last$^d$: $S \times i \mapsto m'$ where $V(m') = \max(S')$. It
  summarises $S'$ with the maximum measure.
\item arithmetic mean$^d$: $S \times i \mapsto m'$ where $V(m') =
  \frac{1}{|S'|} \sum\limits_{\forall m\in S'} V(m)$. It
  summarises $S'$ with the mean of the measure values.
\end{itemize}


Second, continuous aggregation functions are based on temporal
function time series operators, that is the time series aggregated
corresponds to a continuous function $S(t)^r$ where $r$ is a
representation. The patterns of these functions leave $T(m')$
undefined as well as the representation $r$ of the time series.  Next
there are some attribute patterns examples, let the time be continuous
on all the time domain $t\in T$:

\begin{itemize}
%\renewcommand{\labelitemi}{--}
\item maximum$^c$: $S \times i \mapsto m'$ where $V(m') =
  \max_{\forall t \in i}(S(t)^r)$. It summarises $S$ with the maximum
  of the measure values in the interval $i$.
\item last$^c$: $S \times i \mapsto m'$ where $V(m') = S(t_f)^r$. It
  summarises $S$ with the value at $t_f$ time instant.
\item mean$^c$: $S \times i \mapsto m'$ where $V(m') =
  \frac{1}{t_f-t_0} \int\limits_{t_0}^{t_f} S(t)^r dt$. It summarises $S$
  with the mean of the function in the interval $i$.
\end{itemize}


The continuous aggregation function patterns can be expressed with
discrete mathematics for each particular representation, that is based
on the temporal interval defined in TSMS. Next we exemplify it by
defining the previous general continuous patterns for two particular
representations: delta and \zohe{}.


Delta attribute aggregation functions $f^\delta$ have a general form
$f^\delta : S \times [t_0,t_f]\mapsto m'$ where $m'=(t',v')$, the
resulting time is interpreted as centred on the interval
$t'=\frac{t_f+t_0}{2}$ and the resulting value depends on the
attribute, let $S'=S[t_0,t_f]^\delta$ be the selection of measures by
delta temporal interval:
\begin{itemize}
%\renewcommand{\labelitemi}{--}
\item maximum$^\delta$: $v' = \max\big(0,\max_{\forall m \in S'}(V(m))\big)$. 
\item last$^\delta$: $v' = \max(S')$.
\item mean$^\delta$: $v' = \frac{1}{t_f-t_0} \sum\limits_{\forall m
    \in S'} V(m)$, as delta function has property $\int\delta(t)dt=1$.
\end{itemize}


\zohe{} attribute aggregation functions $f^\zohe{}$ have a general
form $f^\zohe{} : S \times [t_0,t_f]\mapsto m'$ where $m'=(t',v')$,
the resulting time is interpreted as right limit of the interval
$t'=t_f$ and the resulting value depends on the attribute, let
$S'=S[t_0,t_f]^\zohe{}$ be the selection of measures by \zohe{} temporal
interval:
\begin{itemize}
%\renewcommand{\labelitemi}{--}
\item maximum$^\zohe{}$: $v' = \max_{\forall m \in S'}(V(m))$. 
\item last$^\zohe{}$: $v' = \max(S')$.
\item mean$^\zohe{}$: $v' = \frac{1}{t_f-t_0} \big[ (T(o)-t_0)V(o) +
  \sum\limits_{\forall m \in S''}( T(m)- T(\prev_S
  m) )V(m) \big]$ where $o=\min(S')$ and $S''= S' - \{o\}$.
\end{itemize}

A similar aggregation function to mean$^\zohe{}$ is used by RRDtool
\cite{rrdtool} in order to summarise information for velocity counter
data by keeping the total counting information, as mean aggregation
can be seen as one keeping the area below the original signal.


In conclusion, some continuous patterns are very similar to discrete
ones. As instance maximum and last attributes differ basically on the
interval selection operation. However, other patterns have a more
elaborated interpretation in a particular representation. As instance
mean$^\zohe{}$ and mean$^\delta$ is an elaborated interpretation for
the general integral definition.




\subsubsection{Data validation}

\todo{potser encara es verd aixo}

% With reference to data validation, attribute aggregate functions
% can cope with this process. When data has not been captured or has
% been captured erroneously, it must be treated as unknown data.
% \begin{itemize}
% \item When data has not been captured it is unknown by nature. For
%   example, we try to capture data from a sensor and there is no
%   response.
% \item When data is erroneously it must be marked as unknown. For
%   example, we capture data from a sensor but it responses in a not
%   reasonable time or we capture data that is clearly outside a
%   reasonable limits.
% \end{itemize}
% As a consequence, attribute aggregate functions deals with these two
% subprocesses: treating unknown data and marking data as
% unknown. Following with real numbers example, we extend the
% domain with a value that means 'unknown', let this unknown value be
% represented by the improper element infinity ($\infty$).

% An attribute aggregate functions treating unknown
% data is a one that can calculate a result when there are unknown
% values in the original time series, $f^u: S \times i \mapsto m'$ where
% $\exists m \in S: V(m)=\infty$. Although from a strict point of view
% operating with unknown data makes unknown result, aggregate functions
% are free to calculate whatever is needed such as time series analysis
% does with data reconstruction.

% For example, arithmetic mean$^{d}$ aggregate function returns
% $V(m')=\infty$ if $\exists m \in S: V(m)=\infty$.  We can define a new
% mean function, based on the original arithmetic mean$^{d}$ aggregate,
% that naively treats unknown values by keeping the
% known mean; in other words, it ignores unknown values found in the time
% interval: arithmetic mean$^{du}$: $S \times i \mapsto m'$ where $m' =
% \text{arithmetic mean}^{d}(S'',i)$ and $S''= \{m''\in S':V(m'')\neq
% \infty\}$.
% % ignore$^{u}$: $S \mapsto S'$ where $S'= \{m''\in S':V(m'')\neq
% % \infty\}$,
% % arithmetic mean$^{du}$: $S \times i \mapsto m'$ where $m' =
% % \text{arithmetic mean}^{d}(\text{ignore}^u(S),i)$.

% An attribute aggregate functions marking data as unknown is a one
% that can give unknown value as the resulting measure's value, $f^{mu}:
% S \times i \mapsto m'$ where $V(m')\in \mathbb{R}\cup\{\infty\}$.

% For example, we can define a maximum aggregate, based on the
% maximum$^d$ aggregate, that returns unknown if there is a
% measure's value bigger than 2:  maximum$^{dmu2}$: $S \times i
% \mapsto m'$ where $V(m') = 
% \begin{cases}
%   \infty &\text{if }  m''>2\\
%   m'' & \text{else }
% \end{cases}$ and $m''=\text{maximum}^d(S,i)$.

% %Per exemple definim un termini, si les dades estan més espaiades que 2 es marca com a desconeguda









\section{Multiresolution over TSMS}

We have defined the MTSMS model as an structure based on time
series. Now we express the multiresolution as a query on a time series
using TSMS operations. 

Given a time series $S$ and a multiresolution time series $M$, a MTSMS
consolidates a multiresolution schema for $S$ by applying successively
$\forall m \in S: M=\addM(M,m)$ and then $M=\consM(M')$ until $M$ is
no more consolidable. Then over this consolidated $M$ we have defined
two basic queries $\seriedisc(M,\delta,f)$ and $\totalseries(M)$.

The time series $S_D=\seriedisc(M,\delta,f)$ stored in a resolution
subseries' disc $R=(B,D)$ where $B=(S_D,\tau,\delta,f)$ and
$D=(S_D,k)$ can be expressed with a map operation over the original
time series $S$:
\[
\seriedisc(M,\delta,f) \equiv \dmap(S,\delta,\tau,f,k)
\]
\[
\dmap(S,\delta,\tau,f,k) = \map(S_I, m_i\mapsto m') \text{ where }
\]
\[
 m' = (T(m_i), f(S, i)),\;  i = [T(\prev_{S_I}(m_i)),T(m_i)]
\]
\[
 S_I = \{ (t,\infty) | t\in T_I  \},\;  t_M = T(\max(S))
\]
\[
T_I = \{ t_I = \tau+n\delta | n\in\N, t_M - k\delta < t_I \leq t_M \}
\]


The total time series $S'=\totalseries(M)$ is a concatenation of all $\seriedisc$ without repeated $\delta$, let $S_\delta = \{ (\delta_0,\tau_0,f_0,k_0)\ldots\}$ be the parameters of $M$ expressed as a multivalued time series \todo{}

\[
S' = \fold(S_\delta,\{\},f_c,\min) \text{ where }
\]
\[
f_c: S_i \times (\delta_c,f_c,k_c) \mapsto S_i || \dmap(S,\delta_c,\tau_c,f_c,k_c)
\]




Summarising, a MTSMS and the multiresolution query are equivalent on functionality. 


\section{TODO}




* Dues variacions possibles interessants pels MTSMS:

 
  - Buffers com a streams, sempre de mida fitada 
  - Discos enllaçats

* Esquema de treball amb TSMS i MTSMS:


        +----+  consultaMultiresolution
        |TSMS| --------------> 
     /  +----+
addM                              fan el mateix les dues vies però
     \  +-----+  total            a sota es pre-calcula com a stream
        |MTSMS| -----------> 
        +-----+









%%% Local Variables:
%%% TeX-master: "main"
%%% ispell-local-dictionary: "british"
%%% End:

% LocalWords:  genericity multiresolution subseries consolidable MTSM

% LocalWords:  pathologies MTSMS TSMS
