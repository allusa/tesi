
\chapter{Esquemes de multiresolució}

\todo{}


Definim una funció de multiresolució com una consulta sobre una sèrie
temporal que ens retorna una nova sèrie temporal resultant
d'aplicar-li un esquema de multiresolució. 

Aquesta funció de multiresolució ens permetrà:

\begin{itemize}
\item Plantejar problemes on veiem la multiresolució com una consulta sobre una sèrie temporal
\item Oferir sistemes duals de \gls{SGSTM} i \gls{SGST} amb operacions
  de consulta multiresolució.
\item Estudiar implementacions per a la consulta de multiresolució, p.ex. para\l.lelisme.
\item Estudiar la teoria de la informació per a l'esquema de multiresolució
\end{itemize}






\section{Funció de multiresolució}

En el model de \gls{SGSTM} hem definit un model de dades de \gls{SGBD}
per a gestionar sèries temporals multiresolució. Com a \gls{SGBD},
aquest model té una estructura i per tant emmagatzema informació d'una
sèrie temporal en una forma determinada: la de multiresolució.  La
definició com a \gls{SGBD} té com a objectius l'emmagatzematge
compacte de les dades i la selecció de la informació ja preparada per
a consultes posteriors. 

Així, aquest model té capacitats de computació
sincronitzada o en línia (\emph{online}) amb el temps i té
característiques dels sistemes que tracten fluxos de dades (\emph{data
  stream}); és a dir dades que s'estan adquirint contínuament i cal
anar computant al mateix temps que es van adquirint. Això no treu,
però, que de manera més simplificada també es pugui treballar amb un
\gls{SGSTM} en temps diferit (\emph{offline}), és a dir que
s'emmagatzemin les dades adquirides i en el moment que es vulgui
aplicar-hi la consolidació.




Això no obstant, podem simplificar el problema de càlcul de
multiresolució en temps diferit com una consulta en un \gls{SGST} de
transformació d'una sèrie temporal a una nova sèrie temporal.

És a dir, sigui $S$ una sèrie temporal, $M$ una sèrie temporal
multiresolució i $\text{e} = \{ (\delta_0,f_0,\tau_0,k_0), \ldots,
(\delta_d,f_d,\tau_d,k_d)\}$ els paràmetres de l'esquema de
multiresolució de $M$. Afegim totes les mesures de la sèrie temporal a
la multiresolució, $\forall m \in S:
M=\glssymbol{addM}(M,m)$\todo{matemàticament és correcte recursivitat
  M=f(M)?}, i la consolidem, $M=\glssymbol{consolidaM}(M')$ fins que
$M$ no sigui consolidable. Consultem la sèrie temporal multiresolució
amb les dues consultes bàsiques, les quals retornen sèries temporals,
$S'=\glssymbol{not:sgstm:serietotal}(M')$ i $S_{\delta
  f}'\glssymbol{not:sgstm:seriedisc}(M',\delta,f)$ on $\delta$ i $f$
són dos paràmetres de l'esquema de multiresolució de $M$ que van
associats amb els altres dos corresponents $\tau$ i $k$.



Plantegem les funcions de transformació de la sèrie temporal original
a les consultades. És a dir, les funcions que anomenem
$\glssymbol{not:sgstm:dmap}$ i $\glssymbol{not:sgstm:multiresolucio}$
i que ens permeten calcular:

\[
\glssymbol{not:sgstm:dmap}: S \times \delta \times f \times \tau \times k \longrightarrow
S'_{\delta f}
\]


\[
 \glssymbol{not:sgstm:multiresolucio}: S \times e  \longrightarrow S'
\]



Definim la consulta de selecció de disc dels \gls{SGSTM} a partir del
mapatge dels \gls{SGST} de manera que, en computació per temps
diferit, són equivalents
\[
\glssymbol{not:sgstm:seriedisc}(M,\delta,f) \equiv
\glssymboldef{not:sgstm:dmap}(S,\delta,f,\tau,k)
\]


\begin{definition}[mapa de \glssymbol{not:sgstm:seriedisc}]
  Sigui $S$ una sèrie temporal, $M$ una sèrie temporal multiresolució
  amb esquema $e$ i $(\delta,f,\tau,k)\in e$ els paràmetres de
  multiresolució d'una subsèrie resolució. L'expressió de
  $\glssymbol{not:sgstm:seriedisc}(M,\delta,f)$ com a mapa d'una sèrie
  temporal és
  $\glssymboldef{not:sgstm:dmap}(S,\delta,f,\tau,k)=\glssymbol{not:sgst:map}(S_I,\glssymbol{not:sgst:fmap})$
  on
  \[
  \glssymbol{not:sgst:fmap}: m_i\mapsto f(S, [T(m_i)-\delta,T(m_i)]),
  \]
  \[
  S_I = \{ (t,\infty) | t\in T_I  \},\;  t_M = T(\max(S)),
  \]
  \[
  T_I = \{ t_I = \tau+n\delta | n\in\glssymbol{not:Z}, t_M - k\delta <
  t_I \leq t_M \}.
  \]
\end{definition}



\begin{example}
  Sigui la sèrie temporal $S=\{(1,0),(3,1),(6,1),(10,1)\}$ i els
  paràmetres de multiresolució
  $((\delta,5),(f,\glssymbol{not:sgstm:maxdd}),(\tau,0),(k,2))$.  El
  mapa de \glssymbol{not:sgstm:seriedisc} és una sèrie temporal $S'=
  \glssymboldef{not:sgstm:dmap}(S,5,0,\glssymbol{not:sgstm:maxdd},2)$
  on $S'=\{(5,1),(10,1)\}$. Expressem el càlcul pas a pas, a la
  \autoref{fig:multiresolucio:dmap} es visualitzen en taula les sèries
  temporals corresponents:
  \begin{enumerate}
  \item El primer pas és obtenir els instants de temps que
    s'emmagatzemarien al disc d'una sèrie temporal
    multiresolució. Així, els instants de consolidació possibles són
    $T_I'=\{\tau+n\delta|n\in\glssymbol{not:Z}\}=
    \{\ldots,-5,0,5,10,15,\ldots\}$. Però un cop consolidat el disc
    només hi haurà els $k=2$ més recents abans de $t_M=T(\max(S))=10$,
    és a dir $T_I=\{t_I'\in T_I'|t_M - k\delta < t_I \leq
    t_M\}=\{5,10\}$.

  \item El segon pas és obtenir a partir de $T_I$ la sèrie temporal
    $S_I$ que es correspon amb la sèrie temporal que s'inicialitzaria
    al disc encara amb valors desconeguts,
    $S_I=\{(5,\infty),(10,\infty)\}$.



  \item El tercer pas és calcular la funció d'agregació a $S$ per a
    cada intervals de consolidació del disc de la forma
    $[T(m_i)-\delta,T(m_i)]$ on $m_i\in S_i$, és a dir $f(S,[0,5])$ i
    $f(S,[5,10])$. A tal efecte utilitzem el mapa sobre $S_I$ per a
    calcular la sèrie temporal resultant $S'=\{ (5,f(S,[0,5])),
    (10,f(S,[5,10])) \}$.

    Podríem calcular un pas entremig que es correspon amb les sèries
    temporals que hi hauria en el buffer abans de cada instant de
    consolidació. Així, per a cada $T(m_i)$ hi hauria la sèrie
    temporal $S[T(m_i)-\delta,T(m_i)]$, és a dir $S_B=\{
    (5,S[0,5],(10,S[5,10]) \}$.


  \end{enumerate}


  


\begin{figure}[tp]
  \centering
  \begin{tabular}[c]{|c|c|}
    \multicolumn{2}{c}{$S$} \\ \hline
    $t$  & $v$ \\ \hline
    1  & 0 \\
    3  & 1 \\
    6  & 1 \\
    10  & 1 \\ \hline
  \end{tabular} \qquad
  \begin{tabular}[c]{|c|c|}
    \multicolumn{2}{c}{$S_I$} \\ \hline
    $t$  & $v$ \\ \hline
    5  & $\infty$ \\
    10  & $\infty$ \\ \hline
  \end{tabular} \qquad
  \begin{tabular}[c]{|c|c|}
    \multicolumn{2}{c}{$S_B$} \\ \hline
    $t$  & $v$ \\ \hline
    5  & \begin{tabular}[c]{|c|c|}\hline $t$  & $v$ \\ \hline 1&0\\ 3&0 \\\hline  \end{tabular} \\\hline
    10  & \begin{tabular}[c]{|c|c|}\hline $t$  & $v$ \\ \hline 6&1\\ 10&1 \\\hline  \end{tabular} \\ \hline
  \end{tabular} \qquad
 \begin{tabular}[c]{|c|c|}
    \multicolumn{2}{c}{$S'$} \\ \hline
    $t$  & $v$ \\ \hline
    5  & 1 \\
    10  & 1\\ \hline
  \end{tabular}
  \caption{Taules de les sèries temporals per l'operació de mapa de  \glssymbol{not:sgstm:seriedisc}}
  \label{fig:multiresolucio:dmap}
\end{figure}
 
\end{example}





Definim la consulta de sèrie temporal total dels \gls{SGSTM} a partir
del plegament dels \gls{SGST} de manera que, en computació per temps
diferit, són equivalents\todo{}
% \[
% \totalseries(M) \equiv \multiresolution(S,\text{sch})
% \]


\begin{definition}[plec de \glssymbol{not:sgstm:serietotal}]
$\glssymboldef{not:sgstm:multiresolucio}$
\end{definition}


% The time series $S_D=\seriedisc(M,\delta,f)$ stored in a resolution
% subseries' disc $R=(B,D)$, where $B=(S_B,\tau,\delta,f)$ and
% $D=(S_D,k)$, can be expressed with a map operation over the original
% time series $S$:


% The total time series $S'=\totalseries(M)$ is a concatenation of all
% $\seriedisc$ without repeated $\delta$. It can be expressed with a
% fold operation over the original time series $S$. Let $\text{sch} = \{
% (\delta_0,\tau_0,f_0,k_0), (\delta_1,\tau_1,f_1,k_1), \ldots,
% (\delta_d,\tau_d,f_d,k_d)\}$ be the parameters of $M$ expressed as a
% multivalued time series
% \[
% \totalseries(M) \equiv \multiresolution(S,\text{sch})
% \]
% \[
% \multiresolution(S,\text{sch}) = \orderfold(\text{sch},\{\},f_r,\min) \text{ where }
% \]
% \[
% f_r: S_i \times (\delta_c,\tau_c,f_c,k_c) \mapsto S_i ||
% \dmap(S,\delta_c,\tau_c,f_c,k_c)
% \]




\todo{}
És a dir que  si, en temps diferit, hem seguit la mateixa inserció de mesures a un \gls{SGST} i un \gls{SGSTM}, 
serà equivalent a tal tal tal en un moment concret.

És a dir, que si hem inserit les mateixes mesures a un \gls{SGST} i a
un \gls{SGSTM}, per una banda consolidem el \gls{SGSTM} i n'obtenim la
sèrie total i per altra banda consultem la multiresolució al
\gls{SGST}: obtenim la mateixa sèrie temporal.


\subsection{Demostració}

Cal demostrar l'equivalència formalment\todo{}





% \section{Multiresolution over TSMS}
% \label{sec:M+TSMS}



% The total time series $S'=\totalseries(M)$ is a concatenation of all
% $\seriedisc$ without repeated $\delta$. It can be expressed with a
% fold operation over the original time series $S$. Let $\text{sch} = \{
% (\delta_0,\tau_0,f_0,k_0), (\delta_1,\tau_1,f_1,k_1), \ldots,
% (\delta_d,\tau_d,f_d,k_d)\}$ be the parameters of $M$ expressed as a
% multivalued time series
% \[
% \totalseries(M) \equiv \multiresolution(S,\text{sch})
% \]
% \[
% \multiresolution(S,\text{sch}) = \orderfold(\text{sch},\{\},f_r,\min) \text{ where }
% \]
% \[
% f_r: S_i \times (\delta_c,\tau_c,f_c,k_c) \mapsto S_i ||
% \dmap(S,\delta_c,\tau_c,f_c,k_c)
% \]



% Summarising, a MTSMS and the multiresolution query are equivalent on
% functionality.



% \subsection{Two database structures}

% \acro{MTSMS} imply a data information selection and so the information
% not considered important is discarded.  Therefore, this systems are
% not adequate when all the monitored data must be kept as
% acquired. This can happen for example when it is not known a priori
% which aggregate functions will work better with the future data
% monitored or when detailed questions must be retrieved such as at what
% hour exactly an event triggered. 

% \begin{figure}
%   \centering
%   \input{imatges/mtsms-tsms.tex}
%   \caption{Dual TSMS+MTSMS}
%   \label{fig:model:mtsms-tsms}
% \end{figure}

% This may be overcome with dual \acro{DBMS} that share measure input,
% as shown in Figure~\ref{fig:model:mtsms-tsms}. One is a \acro{TSMS}
% for long-term deposit and only consulted in occasional cases, it can
% be \acro{TSMS} with other compression techniques or large size
% \acro{DBMS}. The other is a \acro{MTSMS} that lossy compresses time
% series.

% Then generic queries can be made from \acro{TSMS} information or from
% \acro{MTSMS} selected information, as instance by TotalSeries. In
% Figure~\ref{fig:model:mtsms-tsms} the logical equivalence of applying
% $S'=\totalseries(M)$ to \acro{MTSMS} and $S'=
% \multiresolution(S,\text{sch})$ to \acro{TSMS} is plotted, however the
% implementation consideration are different. If we regard the resulting
% time series $S'$ as a view of database information, then the
% $\multiresolution$ is a view that must be computed fully at every new
% measure addition and $\totalseries$ is a view that can be computed
% incrementally at every new addition as explained next.


% Time series data volume uses to be very big and increases along
% time. However, this increase is due to a continuous acquisition of
% data. When data comes as an ordered sequence of instances it is called
% data stream, then specific \acro{DBMS} are designed to manage data
% stream data \cite{stonebraker05:sigmod}.  \acro{MTSMS} can take
% advantage of data stream orientation in order to simplify the
% consolidation process.  Assuming a time order acquisition of time
% series, the update of a \acro{MTSMS} only consists in the addition of
% new measures and the incremental consolidation of subseries.  As a
% consequence \acro{MTSMS} can be seen as a time series view
% pre-computing system for a pair of aggregation statistics and time
% resolution operations.  Then this pre-computation can be used for
% another queries, limited to the aggregations previously computed, or
% for graphical visualisations like the ones done by RRDtool
% \cite{rrdtool}.

% We then have showed a structure for manipulating in time order as then there are no updates in data and it can be managed more simpler. 

%* Important! dir que si seguim l'addició amb ordre de les mesures, aleshores es pot fer l'stream en els MTSMS ja que no hi ha possibilitat d'operacions d'UPDATE.




% \subsection{Stream orientation}

% \todo{}
% * Dues variacions possibles interessants pels MTSMS:

 
%   - Buffers com a streams, sempre de mida fitada 
%   - Discos enllaçats





%%% Local Variables:
%%% TeX-master: "main"
%%% End:






%  LocalWords:  multiresolució
