\chapter[Model RRD]{Model dels SGBD Round Robin}\label{cap:model-rrd}

En aquest capítol es dissenya un model matemàtic per a les bases de dades Round Robin (RRD). Aquest model està inspirat en el sistema de gestió de bases de dades RRDtool i és el resultat de l'abstracció dels conceptes que s'han exposat als capítols \ref{cap:rrdtool} i \ref{cap:rrdtool-etapes}. 

A l'inici del capítol, s'introdueix el concepte de model matemàtic per a les bases de dades. 
A continuació, es defineixen els conceptes necessaris per a finalment definir una base de dades Round Robin. 
Al final del capítol, es resumeix breument la informació exposada.

  

\section{Introducció}

Segons Date,~\cite{Date}, ``una base de dades és un contenidor informàtic per a una co\l.lecció de dades''. El sistemes informàtics que tracten amb bases de dades s'anomenen sistemes de gestió de bases de dades (SGBD) i tenen l'objectiu d'emmagatzemar informació i permetre consultar i afegir aquesta informació  per part dels usuaris.
Per complir aquests objectius, els SGBD ofereixen a l'usuari diferents operacions a fer amb la base de dades, com per exemple crear-la, afegir dades o consultar informació a partir de les dades emmagatzemades.

Els SGBD es basen en teories matemàtiques que reben el nom de model de dades, un SGBD és una implementació d'un model de dades.
Segons Date, ``un model de dades és una definició abstracta, auto continguda i lògica dels objectes, de les operacions i  de la resta que conjuntament constitueixen la màquina abstracta amb la que els usuaris interactuen. Els objectes permeten modelar l'estructura de les dades. Les operacions permeten modelar el comportament''.

Les bases de dades Round Robin són bases de dades que contenen sèries temporals. Les sèries temporals són una co\l.lecció de dades mesurades en diferents instants de temps i necessiten un tractament adequat per part de la base de dades. 
El model de dades Round Robin és una solució d'emmagatzematge per a les sèries temporals que, resumint, consisteix a repartir la informació d'una sèrie temporal en intervals de temps diferents.

El model de dades Round Robin es dissenya per primera vegada en aquest capítol. 
Actualment existeix un SGBD, RRDtool, que implementa conceptes susceptibles d'esdevenir un model de dades però enlloc s'ha recollit com a tal. A partir de l'anàlisi i l'abstracció profunda dels conceptes de RRDtool s'ha dissenyat el model de dades Round Robin, batejat segons el nom que té a RRDtool (\emph{Round Robin Database tool}). Els conceptes de RRDtool s'han exposat detalladament als capítols \ref{cap:rrdtool} i \ref{cap:rrdtool-etapes}. 


Així doncs, a continuació es presenta el model de dades Round Robin. 
Es defineixen els objectes principals d'estudi: les \emph{mesures} i les \emph{sèries temporals}. Les \emph{mesures} són dades mesurades en un instant de temps i les \emph{sèries temporals} són co\l.leccions de mesures, a cada base de dades Round Robin hi ha emmagatzemada una sèrie temporal. 

El model de dades Round Robin s'estructura a partir de \emph{discs Round Robin}, els quals  acumulen temporalment les \emph{mesures} en un \emph{buffer} per tal de tractar-les abans d'emmagatzemar-les  a un \emph{disc}. El tractament principal consisteix en canviar els intervals de temps entre \emph{mesures} amb l'objectiu de compactar la informació de la sèrie temporal.
Així doncs, la sèrie temporal queda emmagatzemada en intervals de temps diferents, repartits en els \emph{discs Round Robin}. 

Pel que fa a les operacions, és indispensable que el model Round Robin pugui fer aquests canvis d'intervals de temps, els quals s'aconsegueixen amb les operacions d'\emph{interpolació} i \emph{consolidació}. En el model de dades Round Robin d'aquest capítol també es defineixen operacions per crear una base de dades Round Robin, per inserir-hi mesures i per representar sèries temporals.




\section{Mesura}\label{sec:model:mesura} 

\begin{definition}[Mesura]
  \label{def:mesura}
  Definim \emph{mesura} com el tuple $(v,t)$, en el que
  $v\in\mathbb{R}$ és el valor de la mesura i $t$ és l'instant de
  temps en que s'ha pres aquesta mesura.
\end{definition}

Donada una mesura $m=(v,t)$ escriurem $V(m)$ per referir-nos a $v$ i
$T(m)$ per referir-nos a $t$.


\begin{definition}[Temps]
  \label{def:temps}
  Siguin $t^a_i$ i $t^a_j$ dos temps absoluts, observem un temps
  relatiu $t^r$ com un valor $t^r \in \mathbb{R}$ que marca la
  distància en unitats de temps entre dos temps absoluts $t^r = t^a_i
  - t^a_j$.
  
  Sigui $t^r$ un temps relatiu i $t^{R}$ un temps absolut de
  referència, observem un temps absolut $t^a$ com un valor $t^a
  \in\mathbb{R}$ que marca el temps relatiu respecte al temps de
  referència $t_a= t^{R} + t^r$ . Aquest valor de referència
  $t^{R}\in\mathbb{R}$ és també un temps absolut però que permet
  definir unívocament la posició de qualsevol altre temps absolut.

  Aquesta definició és coherent amb la d'un sistema de coordenades.
\end{definition}

El temps absolut també s'anomena instant de temps i el temps relatiu, durada.
En resum, els temps absoluts es poden veure com una seqüència de valors reals que indiquen esdeveniments amb ordre clarament definit i entre dos temps absoluts sempre hi ha un temps relatiu que indica durada. Tant els temps absoluts com els temps relatius s'expressen amb un real que té unitats de temps, segons en sistema internacional. 





Donades dues mesures és fàcil establir la relació d'ordre induïda pel
temps.

\begin{definition}
  \label{def:relacio-ordre}
  Sigui $m=(v_m,t_m)$ i $n=(v_n,t_n)$. Direm que $m\geq n$ si i solament
  si $t_m\geq t_n$.
\end{definition}

En la definició~\ref{def:mesura}, el valor d'una mesura és un
escalar. Això no obstant, és fàcil estendre el concepte a mesures
multivaluades, que representen una co\l.lecció de valors
mesurats en el mateix instant de temps tal i com es fa, per exemple a
A\ss falg, \cite{assfalg08:_advan_analy_temp}.

\begin{definition}[Mesura multivaluada]
  Definim \emph{mesura} com el tuple $(v,t)$, en el que
  $v\in\mathbb{R}^n$ és el valor de la mesura i $t$ és l'instant de
  temps en que s'ha pres aquesta mesura.
\end{definition}



\section{Sèrie temporal}
\label{sec:model:serietemporal}

Les sèries temporals són seqüències de mesures ordenades en el temps. 
Tradicionalment s'anomenen sèries temporals tot i que en algun lloc també s'anomenen seqüències temporals, per exemple al capítol 2 de Last,~\cite{last}.


\begin{definition}[Sèrie temporal]
  Una sèrie temporal $S$ és un conjunt de mesures
  $S=\{m_0,\ldots,m_k\}$ tal que 
  $\forall i,j: i\leq k, j\leq k, i\neq j : T(m_i)\neq T(m_j)$.
\end{definition}

La relació definida a~\ref{def:relacio-ordre} indueix sobre una sèrie
temporal una relació d'ordre total. Com que la sèrie temporal s'ha
considerat finita, això comporta l'existència d'un màxim i d'un mínim.
Si $S$ és una sèrie temporal, $\max(S)$ i $\min(S)$ són respectivament
la mesura màxima i mínima d'$S$. 

\begin{definition}
  Sigui $S=\{m_0,\ldots,m_k\}$ una sèrie temporal i $n\in S$ una
  mesura.  Direm que $n=\max(S)$ és el màxim de la sèrie temporal si
  $\forall m \in S: n \geq m $.  Direm que $n=\min(S)$ és el mínim de
  la sèrie temporal si $\forall m \in S: n \leq m$.
\end{definition}

Atesa la relació d'ordre induïda pel temps en una sèrie temporal és
possible definir el concepte d'interval sobre la seqüència, semblant a
com es fa als capítols 1 i 2 de Last,~\cite{last}.

\begin{definition}
  Sigui $S=\{m_0, \ldots, m_k\}$ una sèrie temporal. Definirem la
  subsèrie $S(r,t] \subseteq S$ com la sèrie temporal $S(r,t]=\{m\in S
  | r<T(m)\leq t\}$, a on $r$ i $t$ són dos instants de temps.

  També es defineix la subsèrie $S(r,\infty)\subseteq S$ com la sèrie
  temporal $S(r,\infty) = S(r,T(\max(S))]$ i la subsèrie
  $S(-\infty,t)\subseteq S$ com la sèrie temporal $S(-\infty,t) =
  \{m\in S | T(\min(S))\leq T(m) < t\}$.
%$S(r,\infty) = \{m\in S | r<T(m)\leq T(\max(S))\}$.  
\end{definition}

Atesa la relació d'ordre induïda pel temps en una sèrie temporal es defineix el concepte de mesura següent i mesura anterior en una seqüència.

\begin{definition}
  Sigui $S=\{m_0, \ldots, m_k\}$ una sèrie temporal i $n,l\in S$ dues
  mesures. Direm que $l$ és el successor de $m$ en $S$ i ho notarem
  com $l=\seg\limits_S(m)$ si i només si $l=\min(S(T(m),\infty))$.
  Direm que $l$ és el predecessor de $m$ en $S$ i ho notarem com
  $l=\ant\limits_S(m)$ si i només si $l=\max(S(-\infty,T(m))$.

  Sigui $o=(\infty,\infty)$ i $p=(\infty,-\infty)$ dues mesures
  indefinides, en els casos que la mesura següent o anterior no
  existeix es defineixen següent i anterior corresponentment com
  $\seg\limits_S(\max S)=o$ i $\ant\limits_S(\min S)=p$.
\end{definition}
Quan no hi hagi dubte de la sèrie temporal que marca l'ordre, escriurem $\seg(m)$ i $\ant(m)$.



\subsection{Regularitat de les sèries temporals} 

Sigui $S=\{m_0,\ldots,m_k\}$ una sèrie temporal, $t$ un instant de temps i $\delta$ una durada de temps, en l'interval de temps $i_0=[t,t+\delta]$ i els seus múltiples $i_j=[t+j\delta \,,\, t+(j+1)\delta]: j=0,1,2,\ldots$,  
la sèrie temporal $S$ és de naturalesa diferent segons la situació dels temps $T(m_i)$ en els intervals de temps $i_j$.
En aquest context, aquests intervals de temps s'anomenen intervals de mostreig, $\delta$ s'anomena període de mostreig i $t$ s'anomena temps d'inici del mostreig.

Una sèrie temporal és regular quan les mesures són equidistants en el temps, tal com ho anomenen al capítol 2 de Last,~\cite{last}.

\begin{definition}[Sèrie temporal regular]
  Sigui $S=\{m_0,\ldots,m_k\}$ una sèrie temporal, $t$ un instant de
  temps i $\delta$ una durada de temps. Direm que $S$ és regular si i
  només si $\forall m \in S(T(\min(S),\infty):T(m) - T(\ant(m)) = \delta$ i
  $T(\min(S))=t$. 
\end{definition}

Si una sèrie temporal és regular, l'anomenem  sèrie temporal mostrejada
regularment amb període de mostreig $\delta$.


Una sèrie temporal és no regular quan no és regular. 
%En les sèries temporals no regulars es poden distingir tres casos: temps real, ultramostreig i inframostreig.

%Una sèrie temporal és de temps real quan a cada interval de mostreig hi ha una i només una mesura. L'interval de mostreig pot estar acotat per un termini $D\leq \delta$.

% \begin{definition}[Sèrie temporal de temps real]
%   Sigui $S=\{m_0,\ldots,m_k\}$ una sèrie temporal, $t$ un instant de
%   temps, $\delta$ una durada de temps i $D$ una durada que indica
%   termini. Direm que $S$ és de temps real si i només si $\forall
%   n\in\{1,\ldots,|S|\}:\exists!m \in S:t+(n-1)\delta \leq T(m) <
%   t+(n-1)\delta+D$.  Aleshores la sèrie temporal està mostrejada en
%   temps real per al temps de mostreig $\delta$ amb compliment del
%   termini $D$.

% \end{definition}

% %Si a més $D=\delta$, direm que $S$ és de temps real estricte.


% \paragraph{Ultramostreig} Una sèrie temporal està ultramostrejada (\emph{upsampling}) quan a cada interval de mostreig hi ha una mesura o més d'una. 
% \[
% \text{Ultramostrejada?}: \text{Sèrie temporal} \times T_0 \times \delta \longrightarrow \text{Booleà}
% \]

% Una sèrie temporal $S$ està ultramostrejada ssi $S$ no és de temps real i $\exists m_i=(v_i,t_i)\in S:T_0+(n-1)\delta \leq t_i < T_0+n\delta:\forall n\in\{1,\ldots,|S|\}$.

% \paragraph{Inframostreig} Una sèrie temporal està inframostrejada (\emph{downsampling}) quan en algun interval de mostreig no hi ha cap mesura. 
% \[
% \text{Inframostrejada?}: \text{Sèrie temporal} \times T_0 \times \delta \longrightarrow \text{Booleà}
% \]

% Una sèrie temporal $S$ està inframostrejada ssi $\nexists m_i=(v_i,t_i)\in S:T_0+(n-1)\delta \leq t_i < T_0+n\delta:\forall n\in\{1,\ldots,|S|\}$.

\subsection{Representació de sèries temporals}

Keogh al capítol 1 de Last,~\cite{last}, cita vàries representacions per les sèries temporals com per exemple \emph{Fourier Transforms}, \emph{Wavelets}, \emph{Symbolic Mappings} o \emph{Piecewise Linear Representation} (PLR), però assenyala aquesta última com la representació més utilitzada. 
La PLR, funció definida a trossos lineal, és l'aproximació d'una sèrie temporal $S$, de llargada $n$, amb $K$ segments rectes. Els segments podrien ser polinomis de qualsevol grau, però la manera més comuna de representar sèries temporals és amb funcions lineals, segons Keogh, \cite{keogh02}.
Per aproximar el segment $S(t_a:t_b]$ d'una sèrie $S$, Keogh defineix dues tècniques: interpolació lineal, la recta que connecta $t_a$ i $t_b$, i regressió lineal, la millor recta que aproxima per mínims quadrats el segment entre $t_a$ i $t_b$.

Però també es pot representar una sèrie temporal amb una funció esglaó (\emph{step} o \emph{staircase function}); és a dir, amb una funció definida a trossos constant (\emph{piecewise constant representation}).
La representació a trossos constant és utilitzada en electrònica als convertidors digital-analògic (DAC, \emph{digital-to-analog converter}). En aquest cas, un senyal discret es considera una sèrie temporal i per reconstruir el senyal continu típicament s'aplica el model de \emph{zero-order hold}, equivalent a la representació a trossos constant,  o el de \emph{first-order hold},  equivalent a la representació a trossos lineal.
El model de \emph{zero-order hold} consisteix en mantenir constant cada valor fins al proper. S'obté una representació a trossos constant que en electrònica s'anomena seqüència de pulsos rectangulars (\emph{rectangular pulses}).

%http://en.wikipedia.org/wiki/Piecewise

%http://ca.wikipedia.org/wiki/Funció_definida_a_trossos

%http://en.wikipedia.org/wiki/Rectangular_function

%http://en.wikipedia.org/wiki/Step_function

% Piecewise Aggregate Approximation (PAA) \cite{keogh00}: aproxima una sèrie temporal partint-la en segments de la mateixa mida i emmagatzemant la mitjana dels punts que cauen dins del segment. Redueix de dimensió $n$ a dimensió $N$

% Adaptive Piecewise Constant Approximation (APCA) \cite{keogh01}: com el PAA però amb segments de mida variable.

A continuació,  la representació  d'una sèrie temporal segons el model de \emph{zero-order hold} s'estén per diferents continuïtats en els intervals de temps de representació.

Sigui $S$ una sèrie temporal, es defineix $S(t)$ com la representació
de la sèrie temporal contínuament al llarg del temps $t$.  En primer
lloc, es representa amb \emph{zero-order hold} a partir de funcions
graó contínues per la dreta (\emph{right-continuous}).

\begin{definition}[Representació amb \emph{zero-order hold}]
Sigui $S=\{m_0,\ldots,m_k\}$ una sèrie temporal, la representació  $S(t)$ amb \emph{zero-order hold} es defineix
\[
\forall t \in \mathbb{R} ,\forall m \in S: S(t) =
\begin{cases}
  V(\min S) & \text{si } t < T(\min S) \\
  V(m) & \text{si }  t\in [T(m),T(\seg m))
\end{cases}
\]
\end{definition}

En segon lloc, es representa $S(t)$ amb \emph{zero-order hold} centrada en
l'interval, definit també a partir de funcions graó contínues per la
dreta.

\begin{definition}[Representació amb \emph{zero-order hold} centrada en l'interval]
  Sigui $S=\{m_0,\ldots,m_k\}$ una sèrie temporal, la representació
  $S(t)$ amb \emph{zero-order hold} centrada en l'interval es defineix
\[
\forall t \in \mathbb{R}  ,\forall m \in S:
S(t) =  
\begin{cases}
  V(m) & \text{si } t = \frac{T(\ant m)+T(m)}{2} \\
  V(m) & \text{si } t\in \left( \frac{T(\ant m)+T(m)}{2},\frac{T(m)+T(\seg m)}{2} \right) \
\end{cases}
\]
\end{definition}

En tercer lloc, es representa $S(t)$ amb \emph{zero-order hold} cap enrere, ara definit a partir de funcions graó contínues per l'esquerra.
\begin{definition}[Representació en \emph{zero-order hold} cap enrere]
  Sigui $S=\{m_0,\ldots,m_k\}$ una sèrie temporal, la representació
  $S(t)$ amb \emph{zero-order hold} cap enrere es defineix
\[
\forall t \in \mathbb{R}  ,\forall m \in S:
S(t) =  
\begin{cases}
  V(\max S) & \text{si } t > T(\max S) \\
  V(m) & \text{si }  t\in (T(\ant m),T(m)]
\end{cases}
\]
\end{definition}

Sigui $S$ una sèrie temporal regular i $\delta$ una durada de temps, aleshores la representació de $S(t)$ amb \emph{zero-order hold} és la mateixa que la de $S(t-\delta)$ amb \emph{zero-order hold} cap enrere i és la mateixa que la de $S(t-\frac{\delta}{2})$ centrada en l'interval. 




\section{Buffer}\label{sec:model:buffer}

Un buffer és un contenidor d'una sèrie temporal, regular o no regular, que mitjançant una funció permet regularitzar aquesta sèrie temporal amb un període de mostreig constant. A l'acció de regularitzar un interval d'una sèrie temporal l'anomenarem consolidació, al període de mostreig contant l'anomenarem pas de consolidació i a la funció de regularització l'anomenarem interpolador.

\begin{definition}[Buffer]
  Definim \emph{buffer} com el tuple $(S,\tau,\delta,f)$, en el que
  $S$ és una sèrie temporal, $\tau$ és el darrer instant de temps de
  consolidació, $\delta$ és la durada del pas de consolidació i $f$ és
  un interpolador.
\end{definition}

La consolidació d'una sèrie temporal s'inicia en un instant de temps concret i té lloc a cada pas de consolidació. Amb la finalitat d'establir els intervals de consolidació de la sèrie temporal, es defineix un buffer inicial.

\begin{definition}\label{def:buffer_buit}
  Definim buffer inicial o buffer buit com el buffer $B_{\emptyset} =
  (\emptyset,t_0, \delta_0, f)$, el qual
  conté una sèrie temporal buida, l'instant de temps inicial de
  consolidació, una durada que indica el pas de consolidació i un
  interpolador.
\end{definition}

A partir del buffer buit es poden conèixer tots els instants de temps de consolidació del buffer, els quals seran $t_0+k\delta, k\in\mathbb{N}$. 
Abans de consolidar, però, cal que la sèrie temporal contingui mesures. L'operació \emph{afegeix} permet afegir una mesura a un buffer.

\begin{definition}
  L'operació \emph{afegeix} afegeix una mesura a la sèrie temporal del buffer:
  \[
  \text{afegeix}: \text{Buffer} \times \text{Mesura} \longrightarrow \text{Buffer}
  \]
  \[
   B \times m \longrightarrow B'= B \cup \{m\}
   \]
\end{definition}

Cada cop que s'afegeix una mesura a un buffer es pot comprovar si el buffer ja és consolidable mitjançant un predicat que ens retorna un booleà: cert o fals. 

\begin{definition}
  Un buffer és consolidable quan el temps d'una mesura de la sèrie temporal és més gran que el proper instant de temps de consolidació:
  \[
  \text{consolidable?}: \text{Buffer} \longrightarrow \text{Booleà}
  \]
  Sigui $B=(S,\tau,\delta,f)$ un buffer i $m=\max(S)$ la mesura màxima, $B$ és consolidable si i només si $T(m) \geq \tau+\delta$
\end{definition}


\subsection{Interpolació}
\label{sec:model:interpolador}

Sigui $S$ una sèrie temporal i $T_0$ i $T_f$ dos instants de temps, un interpolador $f$ calcula la mesura que resumeix a $S$ en un interval de temps $i=[T_0,T_f]$. 
\[
f: \text{Sèrie temporal} \times \text{interval de temps} \longrightarrow \text{Mesura}
\]

Hi poden haver diferents interpoladors depenent de com es vol resumir la sèrie temporal. A més, la representació de la sèrie temporal influeix en la manera d'interpolar. A continuació es defineixen alguns interpoladors per a sèries temporals representades amb  \emph{zero-order hold} cap enrere, a on l'interval de temps d'interpolació $i$ s'interpreta continu per l'esquerra $(T_0,T_f]$. 


\begin{definition}[Interpolador mitjana aritmètica]
  Sigui $S=\{m_0,\ldots,m_k\}$ una sèrie temporal, $S(t)$ la
  representació de la sèrie temporal amb \emph{zero-order hold} cap
  enrere i $i=[T_0,T_f]$ un interval de temps, l'interpolador mitjana
  aritmètica (MA) resumeix $S(t)$ amb una mesura que és la mitjana dels
  valors de les mesures al conjunt $S(T_0,T_f]$.
\[
MA: \text{Sèrie temporal} \times \text{interval de temps}
\longrightarrow \text{Mesura}
\]
\[
S=\{m_0,\ldots,m_k\} \times i=[T_0,T_f] \longrightarrow m'=(v',T_f)
\]
\[
S'=S(T_0:T_f]:
v' = \frac{1}{|S'|} \sum\limits_{\forall m\in S'} V(m)
\]
\end{definition}

\begin{definition}[Interpolador màxim]
  Sigui $S=\{m_0,\ldots,m_k\}$ una sèrie temporal, $S(t)$ la
  representació de la sèrie temporal amb \emph{zero-order hold} cap
  enrere i $i=(T_0,T_f]$ un interval de temps, l'interpolador màxim
  (MAX) resumeix $S(t)$ amb una mesura que és el màxim dels valors
  de les mesures al conjunt $S(T_0,T_f]$.
\[
MAX: \text{Sèrie temporal} \times \text{interval de temps} \longrightarrow \text{Mesura}
\]
\[
S=\{m_0,\ldots,m_k\} \times i=[T_0,T_f]  \longrightarrow m'=(v',T_f)
\]
\[
S'=S(T_0:T_f]:
v' = \max_{\forall m \in S'}(V(m))
\]
\end{definition}

De manera dual es pot definir l'interpolador mínim (MIN) com el
que resumeix $S(t)$ amb una mesura que és el mínim dels valors de les
mesures al conjunt $S(T_0,T_f]$.


\begin{definition}[Interpolador últim]
  Sigui $S=\{m_0,\ldots,m_k\}$ una sèrie temporal, $S(t)$ la
  representació de la sèrie temporal amb \emph{zero-order hold} cap
  enrere i $i=(T_0,T_f]$ un interval de temps, l'interpolador últim
  (LAST) resumeix $S(t)$ amb una mesura que és la mesura màxima del
  conjunt $S(T_0,T_f]$.
\[
LAST: \text{Sèrie temporal} \times \text{interval de temps} \longrightarrow \text{Mesura}
\]
\[
S=\{m_0,\ldots,m_k\} \times i=[T_0,T_f]  \longrightarrow m'=(\max(S(T_0:T_f]),T_f)
\]
\end{definition}



\begin{definition}[Interpolador àrea]
  Sigui $S=\{m_0,\ldots,m_k\}$ una sèrie temporal, $S(t)$ la
  representació de la sèrie temporal amb \emph{zero-order hold} cap
  enrere i $i=(T_0,T_f]$ un interval de temps, l'interpolador àrea
  (AREA) resumeix $S(t)$ amb una mesura que conserva l'àrea sota la
  corba de la representació \emph{zero-order hold} cap enrere del
  conjunt $S(T_0,T_f]$.
\[
AREA: \text{Sèrie temporal} \times \text{interval de temps} \longrightarrow \text{Mesura}
\]
\[
S=\{m_0,\ldots,m_k\} \times i=[T_0,T_f]  \longrightarrow m'=(v',T_f)
\]
\[
v' = 
\frac{\int_{T_0}^{T_f} S(t) dt}{T_f - T_0}
\]
per $S(t)$ estar definida a trossos, $v'$ es pot expressar com
\[
n=\min(S(T_f,\infty),
o=\min(S(T_0:T_f]), 
S'= S(T_0:T_f] - \{o\}:
\]
\[
:v'= \frac{(T(o)-T_0)V(o) 
+( T_f- T(\ant\limits_S n) )V(n) 
+\sum\limits_{\forall m \in S'}( T(m)- T(\ant\limits_S m) )V(m)}
{T_f-T_0} 
\]
\end{definition}

%Quan una sèrie temporal és regular, l'intepolador mitjana aritmètica i l'interpolador àrea valen el mateix en l'interval $(T_o,n\delta]$.


\subsection{Consolidació}

Quan un buffer és consolidable, es pot calcular una mesura de consolidació de la sèrie temporal per cada interval de temps consolidable. De manera simplificada, a cada consolidació només es té en compte l'interval que comença al darrer temps de consolidació del buffer. 

Sigui $B=(S,\tau,\delta,f)$ un buffer consolidable, la mesura de consolidació de $B$ en l'interval de temps $i=[\tau,\tau+\delta]$ és $m'=(v,\tau+\delta)$ on $m'=f(S,i)$ i $f$ és un interpolador. L'operació \emph{consolida} permet consolidar la sèrie temporal del buffer calculant-ne la mesura de consolidació.

\begin{definition}
  L'operació \emph{consolida} calcula la mesura de consolidació i treu
  les mesures consolidades de la sèrie temporal del buffer, en
  l'interval de consolidació actual:
  \[
  \text{consolida}: \text{Buffer} \longrightarrow \text{Buffer} \times \text{Mesura}
  \]
  \[
  B=(S,\tau,\delta,f) \longrightarrow B' \times m'
  \]
  \[
  B'= (S',\tau+\delta,\delta,f)
  \]
  \[
  S' = S(\tau+\delta,\infty)
  \]
  \[
  m' = f(S,[\tau,\tau+\delta]): f \text{ és un interpolador}
  \]
\end{definition}



\section{Disc}\label{sec:model:disc}

Un disc és un contenidor d'una sèrie temporal regular amb un nombre acotat de mesures. En arribar al nombre màxim de mesures permeses, cada cop que s'afegeix una mesura nova s'elimina la mesura mínima de la sèrie temporal.
Així doncs, un disc és semblant a una cua FIFO (\emph{First In First Out}), a on el primer d'arribar és el primer de sortir.  

\begin{definition}[Disc]
  Definim \emph{disc} com el tuple $(S,k)$, en el que $S$
  és una sèrie temporal i $k\in\mathbb{N}$ és el cardinal màxim de $S$.
\end{definition}

A l'inici, un disc no conté mesures però cal que estigui caracteritzat pel cardinal màxim. Amb aquesta finalitat es defineix un disc inicial.

\begin{definition}\label{def:disc_buit}
  Definim disc inicial o disc buit com el disc $D_{\emptyset} =
  (\emptyset,k)$, el qual conté una sèrie temporal buida i el cardinal
  màxim que podrà prendre $S$.
\end{definition}

L'operació \emph{afegeix} permet afegir una mesura a un disc, controlant-ne el cardinal màxim.

\begin{definition}
  L'operació \emph{afegeix} afegeix una mesura a la sèrie temporal del disc:
  \[
  \text{afegeix}: \text{Disc} \times \text{Mesura} \longrightarrow \text{Disc}
  \]
  \[
  D=(S,k) \times m \longrightarrow D'= (S',k)
  \]
  \[
  S' =  
  \begin{cases}
      S\cup\{m\} &\text{si }  |S|<k\\
      (S-\{\min(S)\}) \cup \{m\} 
    \end{cases}  \
  \]
\end{definition}


\section{Disc Round Robin}\label{sec:model:discroundrobin}

Un disc Round Robin és un disc amb buffer. En el buffer hi ha la part d'una sèrie temporal a regularitzar i en el disc hi ha l'altra part ja regularitzada, amb un nombre acotat de mesures. 

\begin{definition}[Disc Round Robin]
  Definim \emph{disc Round Robin} com el tuple $(B,D)$, en el que $B$
  és un buffer i $D$ és un disc.
\end{definition}
 
Per una banda, la definició de buffer buit (def.~{\ref{def:buffer_buit}) i de disc buit (def.~\ref{def:disc_buit}) indueixen a una definició de Disc Round Robin buit. 

\begin{definition}\label{def:disc_round_robin_buit}
  Definim disc Round Robin buit com el disc Round Robin $R_{\emptyset}
  = (B_{\emptyset},D_{\emptyset})$, el qual conté un buffer buit i un
  disc buit.
\end{definition}

Per altra banda, les operacions dels buffers i dels discs estan relacionades amb les operacions dels discs Round Robin. 

L'operació \emph{afegeix} permet afegir una mesura a un disc Round Robin.

\begin{definition}
  L'operació \emph{afegeix} afegeix una mesura al buffer del disc Round Robin:
  \[
  \text{afegir}: \text{Disc Round Robin} \times \text{Mesura} \longrightarrow \text{Disc Round Robin}
  \]
  \[
  R=(B,D) \times m \longrightarrow R'= (B',D)
  \]
  \[
  B'= B \text{ afegeix } m
  \]
\end{definition}

Cada cop que s'afegeix una mesura a un disc Round Robin es pot comprovar si ja és consolidable. 

\begin{definition}
  Un disc Round Robin és consolidable quan el seu buffer és consolidable:
  \[
  \text{consolidable?}: \text{Disc Round Robin} \longrightarrow \text{Booleà}
  \]
  Sigui $R=(B,D)$ un disc Round Robin, $R$ és consolidable si i només
  si $B$ és consolidable.
\end{definition}


Quan un disc Round Robin és consolidable, es pot consolidar amb l'operació \emph{consolida}. 

\begin{definition}
  L'operació \emph{consolida} calcula una  mesura de consolidació del buffer, en
  l'interval de consolidació actual, i la desa al disc. 
  \[
  \text{consolida}: \text{Disc Round Robin} \longrightarrow \text{Disc Round Robin}
  \]
  \[
  R=(B,D) \longrightarrow R'= (B',D')
  \]
  \[
  B' \times m'= \text{ consolida } B 
  \]
  \[
  D'= D \text{ afegeix } m'
  \]
\end{definition}



\section{Base de dades Round Robin}\label{sec:model:rrd}

Una base de dades Round Robin és un arxiu de discs Round Robin que comparteixen l'entrada de mesures, les quals provenen d'una sèrie temporal. En aquesta entrada de mesures hi pot haver un buffer d'entrada comú per tal que els discs Round Robin rebin la sèrie temporal regularitzada. Amb buffer d'entrada o sense, la sèrie temporal queda regularitzada i distribuïda en els diferents discs Round Robin. A la figura~\ref{fig:model:esquemarrd} es representa esquemàticament una base de dades Round Robin.

\begin{definition}[Base de dades Round Robin]
  Definim \emph{base de dades Round Robin} com el tuple $(B,A)$, en el
  que $B$ és un buffer i $A$ és un conjunt de discs Round Robin
  $A=\{R_0,\ldots,R_d\}$.
\end{definition}


\begin{figure}[htp]
\centering
\setlength{\unitlength}{0.4mm}
\input{imatges/model/arxiurrd.tex}
\caption{Esquema del model de dades Round Robin}
\label{fig:model:esquemarrd}
\end{figure}


Per una banda, aquest conjunt de discs Round Robin cadascun amb la
seva definició de buit (def~\ref{def:disc_round_robin_buit}) i
la definició de buffer buit (def~\ref{def:buffer_buit}) pel buffer comú
d'entrada, indueixen a una definició de base de dades Round Robin
buida.

\begin{definition}
  Definim base de dades Round Robin buida com la base de dades Round
  Robin $M_{\emptyset} = (B_{\emptyset},A_0)$, la qual conté un buffer
  buit i un arxiu amb quantitat $d$ de discs Round Robin $A_0 =
  \{R_0,\ldots,R_d\}$ on cada disc Round Robin és buit
  $R_i=R_{\emptyset}$.
\end{definition}

Normalment, en el conjunt de discs Round Robin $A_0$ no hi ha elements
repetits amb la mateixa informació. És a dir, donats dos discs Round
Robin $R_a = (B_a, D_a)$ i $R_b = (B_b, D_b)$, els seus respectius
buffers $B_a=(S_a,\tau_a,\delta_a,f_a)$ i
$B_b=(S_b,\tau_b,\delta_b,f_b)$ no tenen el mateix interval de
consolidació i interpolador: $\delta_a \neq \delta_b \wedge f_a \neq
f_b$. 



Per altra banda, les operacions del buffer d'entrada i dels discs
Round Robin estan relacionades amb les operacions de les base de dades
Round Robin.

L'operació \emph{afegeix} permet afegir una mesura a una base de dades
Round Robin. Concretament s'afegeix al buffer d'entrada comú.
\begin{definition}
  L'operació \emph{afegeix} afegeix una mesura a la base de dades Round Robin:
  \[
  \text{afegeix}: \text{Base de dades Round Robin} \times \text{Mesura} \longrightarrow \text{Base de dades Round Robin}
  \]
  \[
  M=(B,A) \times m \longrightarrow M'= (B',A)
  \]
  \[
  B'= B \text{ afegeix } m
  \]
\end{definition}

Cada cop que s'afegeix una mesura a una base de dades Round Robin es pot comprovar si ja és consolidable. 

\begin{definition}
  Una base de dades Round Robin és consolidable quan el seu buffer és
  consolidable:
  \[
  \text{consolidable?}: \text{Base de dades Round Robin} \longrightarrow \text{Booleà}
  \]
  Sigui $M=(B,A)$ una base de dades Round Robin, $M$ és consolidable si i només
  si $B$ és consolidable.
\end{definition}

Quan una base de dades Round Robin és consolidable, es pot consolidar amb l'operació \emph{consolida}. 
 
\begin{definition}
  L'operació \emph{consolida} calcula una mesura de consolidació del
  buffer, en l'interval de consolidació actual, i la desa a tots els
  disc Round Robin de l'arxiu.
  \[
  \text{consolida}: \text{Base de dades Round Robin} \longrightarrow
  \text{Base de dades Round Robin}
  \]
  \[
  M=(B,A),\ A = \{R_0,\ldots,R_d\} \longrightarrow M'= (B',A')
  \]
  \[
  B' \times m'= \text{ consolida } B 
  \]
  \[
  A'= \forall R_i\in A: R_i \text{ afegeix } m'
  \]
\end{definition}

Finalment, les operacions de consolidació dels disc Round Robin també tenen la relació corresponent a la base de dades Round Robin. Aquestes consolidacions es poden veure com que els discs 'roden' i per tant les operacions s'anomenen amb aquesta arrel.

Cada cop que es consolida una base de dades Round Robin es pot comprovar si ja és rodable. 

\begin{definition}
  Una base de dades Round Robin és rodable quan hi ha un disc Round
  Robin consolidable.
  \[
  \text{rodable?}: \text{Base de dades Round Robin} \longrightarrow \text{Booleà}
  \]
  Sigui $M=(B,A)$ una base de dades Round Robin amb l'arxiu $A$ com un conjunt de discs Round Robin $A = \{R_0,\ldots,R_d\}$, $M$ és rodable si i només
  si  $\exists R_i\in A$ tal que $R_i$ és consolidable.
\end{definition}

Quan una base de dades Round Robin és rodable, es pot rodar amb l'operació \emph{roda}. 
 
\begin{definition}
  L'operació \emph{roda} calcula una mesura de consolidació del
  buffer, en l'interval de consolidació actual, i la desa a tots els
  disc Round Robin de l'arxiu.
  \[
  \text{roda}: \text{Base de dades Round Robin} \longrightarrow
  \text{Base de dades Round Robin}
  \]
  \[
  M=(B,A),\ A = \{R_0,\ldots,R_d\} \longrightarrow M'= (B,A')
  \]
  \[
  A'= \{R_0',\ldots,R_{|A|}'\}: \forall R_i \in A: R_i' =
  \left\{ \begin{array}{l}
      \text{ consolida } R_i \qquad \text{si } R_i \text{ és consolidable }\\
      R_i
    \end{array} \right.
  \]
\end{definition}


\section{Resum}

Aquest capítol s'acaba amb un resum dels conceptes exposats en el model de dades Round Robin. Una base de dades Round Robin és un sistema informàtic d'emmagatzematge d'una sèrie temporal entesa com una  una co\l.lecció de dades mesurades en diferents instants de temps.

A la base de dades, la sèrie temporal queda estructurada com s'ha esquematitzat a  la figura~\ref{fig:model:esquemarrd}. És una forma compacta d'emmagatzemar la sèrie temporal de manera que queda repartida segons diferents funcions d'interpolació i períodes de mostreig. Aquest repartiment té lloc en els diferents discs Round Robin, els quals fan ús del seu buffer per interpolar les mesures i fan ús del seu disc per consolidar-les. 

El conjunt de discs Round Robin constitueixen la part principal d'una base de dades Round Robin tot i que, com a l'esquema, hi pot haver un buffer d'entrada de mesures comú per tal de regularitzar la sèrie temporal des d'un principi, ja que el pas de no regular a regular requereix interpoladors més complicats.


En el capítol~\ref{cap:roundrobinson}, utilitzant el llenguatge de programació Python es dissenya, a nivell acadèmic, un sistema de gestió de bases de dades que implementa el model de dades Round Robin tal com s'ha definit en aquest capítol.


En resum, a partir del model de dades Round Robin descrit en aquest capítol per una banda es poden estudiar quin efecte té una configuració determinada de paràmetres i per altra banda es poden dissenyar sistemes de gestió de bases de dades assegurant que implementen el model i per tant que tenen el funcionament desitjat.




% \section{Tractament dels desconeguts}

% Sigui $m=(v,t)$ una mesura, s'ha definit com un valor $v\in\mathbb{R}$ mesurat en el temps $t$. Ara bé, els valors també poden ser desconeguts
% \[
% v\in\mathbb{R} \cup \{'desconegut'\}
% \]

% Els valors desconeguts  són aquells valors que no existeixen (es desconeixen, \emph{missing data} ) o que s'ignoren (es descarten, \emph{censoring} o \emph{truncation}). 

% Els valors que no existeixen prenen el valor desconegut en el moment de la mesura. En canvi, els valors descartats són marcats com a desconeguts si no passen una verificació de dades. 

% La censura per interval és una verificació possible. En aquesta, un valor $v$ es considera desconegut quan $v<L_{m}$ o $v>L_{M}$.


% Sigui $m=(v,t)$ una mesura, $m$ és desconeguda si $v$ és desconegut.

% Sigui $S=\{m_0,\ldots,m_k\}$ una sèrie temporal i $H$ un termini de temps, una mesura $m_i=(v_i,t_i)\in S$ és desconeguda si, donada la mesura anterior $m_{i-1}=(v_{i-1},t_{i-1})$, $t_i - t_{i-1} > H$.


% Sigui $f$ un interpolador, en el moment de calcular la mesura de consolidació $f$ decideix si és desconeguda
% \[
% desconeguda?: \text{Sèrie temporal} \times \text{interval} \longrightarrow \text{Mesura}
% \]

% Sigui $S=\{m_0,\ldots,m_k\}$ una sèrie temporal, $f$ un interpolador, $i=[T_0,T_f]$ un interval de temps i $\alpha$ un llindar, la mesura de consolidació calculada per l'interpolador $f$ és desconeguda ssi  
% \[
% \frac{t_d }{T_f - T_0} > \alpha :
% \]
% \[
% :t_d = t_{d0} + t_{df} + \sum\limits_{i=1}^{k-1}(t_i-t_{i-1}) : v_k = 'desconegut':
% \]
% \[
% : t_{d0} = \left\{\begin{array}{l} t_0-T_0 \text{ si } v_0 = 'desconegut' \\ 0\end{array}\right. ,
% t_{df} = \left\{\begin{array}{l} T_f-t_{k-1} \text{ si } v_k = 'desconegut' \\ 0\end{array}\right. :
% \]
% \[
% :k=|S|-1,(v_k,t_k)=m_k\in S' :S'= S_{T_0:T_f} \cup \{min(S_{T_f:\infty})\}
% \]



%%% Local Variables:
%%% TeX-master: "memoria"
%%% End:
% LocalWords:  Round  buffer buffers





