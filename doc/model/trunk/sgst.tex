
\chapter{Model SGST}

En aquest capítol es defineixen els objectes que ens permeten modelar l'estructura de les dades.

Dos models estructurals:

* Hi ha un model pels SGST (TSMS) que inclou mesura i sèries temporals.

* Hi ha un model pels SGSTM (MTSMS) que té buffer, discs i mtsdb, els quals inclouen el model de sèrie temporal del SGST.




\section{Model estructural de dades}

Una sèrie temporal és una relació de temps i valors. A cada parella
temps-valor l'anomenem mesura. Així doncs, una sèrie temporal és un
conjunt de mesures. Una mesura és un tuple temps-valor.



Una mesura és un valor mesurat en un instant de temps i una sèrie
temporal és un co\l.lecció de mesures.





\subsection{Temps}

Utilitzem el temps com un valor que ens permet ordenar les mesures.  A
tal efecte, el domini del temps es defineix com un conjunt
tancat %(compactificat?)
i amb ordre total. Pot ser tant un conjunt finit com infinit. \todo{cal que sigui tancat? les mesures indefinides es defineixen en aquest tancament}

Per facilitar la comprensió, en el document utilitzarem el conjunt de
reals com a conjunt pels temps. Concretament, per a complir que sigui
un conjunt tancat usarem el conjunt estès de nombres reals
$\bar{\mathbb{R}} \in \mathbb{R} \cup
\{+\infty,-\infty\}$, \parencite{wiki:extendedreal,cantrell:extendedreal},
també anomenat recta real acabada.


El conjunt estès de nombres reals té dos punts límits corresponents al
valor impropi infinit, aleshores en notació d'interval el conjunt es
pot escriure com $\bar{\mathbb{R}} \in [-\infty,+\infty]$.  Més
endavant a la definició~\ref{def:model:mesura_indefinida} es detallen
algunes propietats induïdes a les mesures com a resultat d'aquesta
extensió.

Les relacions d'ordre i algunes operacions aritmètiques s'estenen al
conjunt $\bar{\mathbb{R}}$, \cite{cantrell:extendedreal}.  Algunes
expressions esdevenen indefinides (p.ex.\ $0/0$) i altres depenen del
context, com és el cas de l'expressió indeterminada $0 \times \infty$ que
per exemple en la teoria de la mesura habitualment es defineix com $0 \times
\infty = 0$, \cite{wiki:extendedreal}.


El conjunt dels reals és un espai mètric ja que té definida una funció
distància (o mètrica), com per exemple la distància euclidiana. Com a
conseqüència, ens permet distingir entre instants de temps (els
elements del conjunt) i durades (la mètrica). Observant els instants
de temps com a punts en la recta real i les durades com a segments de
la recta real, es pot definir el temps com a sistema de coordenades
especificant un instant com a marc de
referència, \parencite{iep:time-supplement,wiki:coordinate}.


\begin{definition}[Temps]
  \label{def:model:temps}
  Siguin $t^i_i$ i $t^i_j$ dos instants de temps, observem la quantitat
  de temps o la durada $t^d$ com un valor $t^d \in\bar{\mathbb{R}}$
  que mesura la distància en unitats de temps entre dos temps
  absoluts $t^d = t^i_i - t^i_j$.
  
  Sigui $t^d$ una durada i $t^{R}$ un temps absolut de referència,
  observem un instant de temps $t^i$ com un valor $t^i
  \in\bar{\mathbb{R}}$ que mesura la quantitat de temps respecte al
  temps de referència $t^i= t^{R} + t^d$ . Aquest valor de referència
  $t^{R}\in\mathbb{R}$ és també un instant de temps però que permet
  definir unívocament la posició de qualsevol altre instant de temps.


\end{definition}

En resum, els instants de temps es poden veure com una seqüència de
valors reals que indiquen esdeveniments amb ordre clarament definit i
entre dos instants de temps sempre hi ha una durada. Tant els instants
de temps com les durades s'expressen amb un real que té unitats de
temps. Aquestes unitats són 'segons' en sistema internacional.



\subsubsection{Calendari}
\textcite{dreyer94} situen els calendaris i les seves operacions com a
essencials en els SGST. Tanmateix, pot no ser necessari modelar les
dates de calendari en el model de temps. El temps és la línia contínua
de temps, el calendari són noms especials a certs punts de la línia de
temps. Només cal una eina que sigui capaç de convertir de noms a
instants de temps.

Per una banda, no afecta al model SGST que els calendaris siguin més o
menys complicats, en aquest cas només es veuen complicades les
funcions de conversió de temps a calendari i viceversa.  Per altra
banda, tampoc afecta que els calendaris siguin ambigus (p.ex.\ dos
noms per al mateix instant o instants sense nom) o que continguin
propietats impredictibles (p.ex.\ cas dels segons addicionals
(intercalats) en UTC) ja que la responsabilitat d'aquests problemes
correspon a la bona definició dels sistemes de calendari.

\todo{}
Unix time (posix) no incorpora els leap seconds.
Millor TAI, unix time (right), ja que és una mesura totalment lineal del temps. 
Unix time, UTC i TAI: http://lwn.net/Articles/504744/


\subsection{Valor}

El \gls{terme:SGBDR:valor} és qualsevol element que és d'un
\gls{terme:SGBDR:tipus}; és a dir, un objecte que
pertany a un determinat conjunt de valors i que té associat les
operacions que s'hi poden aplicar. Exemples de tipus de dades són els
enters, els reals, les cadenes de text i les estructures de dades com
vectors, llistes o \glspl{terme:SGBDR:relacio}.  \todo{vigilar amb
  date, ell en diu escalars i no escalars (amb components visibles) i
  per exemple considera que un punt és escalar}

\todo{Exemplificar més amb tipus que tenen valors i operacions que se'ls poden aplicar}


El model de dades dels valors ha d'incloure una dada que defineixi el
valor indefinit. Més endavant a la
definició~\ref{def:model:mesura_valor_indefinit} es detallen les
propietats de les mesures amb valor indefinit. Seguint l'exemple amb
els reals, el valor indefinit es defineix amb el valor impropi infinit
del conjunt dels reals estès
projectivament, \parencite{cantrell:projectivelyextendedreal},
$\mathbb{R}^*\in\mathbb{R} \cup \{\infty\}$.


En aquest exemple amb reals, el valor és un escalar però fàcilment es
pot estendre el concepte a valors multivaluats ${\mathbb{R}^*}^n$ que
representin una co\l.lecció de valors mesurats en el mateix instant de
temps, tal i com fa per exemple \textcite{assfalg08:thesis}.







\subsection{Mesura}\label{sec:model:mesura} 

Una mesura és una parella de temps i valor.

\begin{definition}[Mesura]
  \label{def:model:mesura}
  Definim \emph{mesura} com el tuple $(t,v)$, en el que $v$ és el
  valor de la mesura i $t$ és l'instant de temps en que s'ha pres
  aquesta mesura.
\end{definition}


Donada una mesura $m=(t,v)$ escriurem $V(m)$ per referir-nos a $v$ i
$T(m)$ per referir-nos a $t$.

L'instant de temps de les mesures indueix una relació d'ordre entre
les mesures.
\begin{definition}[Relació d'ordre]
  \label{def:model:mesura-relacio-ordre}
  Sigui $m=(t_m,v_m)$ i $n=(t_n,v_n)$. Direm que $m\geq n$ si i solament
  si $t_m\geq t_n$.
\end{definition}


En les definicions de temps i valor s'han estès els conjunts amb
valors impropis, concretament s'ha exemplificat amb el conjunt estès
de nombres reals afí $\bar{\mathbb{R}} \in \mathbb{R} \cup
\{+\infty,-\infty\}$ i amb el projectiu $\mathbb{R}^*\in\mathbb{R}
\cup\{\infty\}$,
\parencite{cantrell:extendedreal,cantrell:projectivelyextendedreal}. Aquesta
extensió amb l'element impropi infinit ($\infty$) dóna com a resultat
unes mesures impròpies que anomenarem mesura de valor indefinit i
mesura indefinida.

\begin{definition}[Mesura de valor indefinit]
  \label{def:model:mesura_valor_indefinit}
  Definim \emph{mesura de valor indefinit} com el tuple $(t,v)$, en el
  que el valor és $v=\infty$ i l'instant de temps és
  $t\in\bar{\mathbb{R}}$.
\end{definition}

\begin{definition}[Mesura indefinida]
  \label{def:model:mesura_indefinida}
  Definim \emph{mesura indefinida} com el tuple $(t,v)$, en el que el
  valor és $v\in\mathbb{R}^*$ i l'instant de temps és
  $t\in\{+\infty,-\infty\}$.
\end{definition}

Així doncs, sigui $m$ una mesura, es podrà notar la mesura de valor
indefinit com $m=(t,\infty)$ i les mesures indefinides com
$m=(+\infty,v)$ per la positiva i $m=(-\infty,v)$ per la negativa, les
quals normalment s'anotaran també amb valor indefinit:
$m=(+\infty,\infty)$ i $m=(-\infty,\infty)$ respectivament.


Les mesures de valor indefinit es podran utilitzar en aquells casos en
els que el valor de la mesura és desconegut. Els valors desconeguts
són aquells valors que no existeixen (es desconeixen, \emph{missing
  data} ) o que s'ignoren (es descarten, \emph{censoring} o
\emph{truncation}). Els valors que no existeixen prenen el valor
desconegut en el moment de la mesura, en canvi els valors descartats
són marcats com a desconeguts després d'un processament de les dades.

Nota: en alguns sistemes es distingeix entre valors infinits
($\infty$) i valors indefinits (NaN, \emph{not a number}),
\cite{wiki:ieee754}. Aquest no és el cas de les definicions de mesures
indefinides presents.







\subsection{Sèrie temporal}
\label{sec:model:serietemporal}

Les sèries temporals són seqüències de mesures ordenades en el temps.
Tradicionalment s'anomenen sèries temporals tot i que també s'anomenen
seqüències temporals, per exemple a \cite{last:hetland}. \todo{les sèries temporals són mesures del mateix fenomen}

\begin{definition}[Sèrie temporal]
  \label{def:serie_temporal}
  Una sèrie temporal $S$ és un conjunt de mesures
  $S=\{m_0,\ldots,m_k\}$ sense temps repetits
  $\forall i,j: i\leq k, j\leq k, i\neq j : T(m_i)\neq T(m_j)$.
\end{definition}

Per ser un conjunt, les sèries temporals tenen mesura de cardinalitat.
\begin{definition}[Cardinal]
  Sigui $S=\{m_0,\ldots,m_k\}$ una sèrie temporal, definim el nombre
  de mesures que conté la sèrie temporal com el cardinal del conjunt
  $|S|=k+1$. Una sèrie temporal sense mesures és la sèrie temporal
  buida $S_\emptyset= \emptyset = \{\}$, és a dir que no té cap element
  $|S_\emptyset|=0$.
\end{definition}


\todo{Observe that, because measures in
S are of the same phenomena, the type of S values is
homogeneous.
}
 




\subsection{Relació sèrie temporal}

Una sèrie temporal és una relació de temps i valors. A cada parella temps-valor l'anomenem mesura. Així doncs, una sèrie temporal és un conjunt de mesures.

Una sèrie temporal és un conjunt de mesures, així doncs s'observa com una relació de grau dos (relació binària)  a on la capçalera conté els atributs temps i valor, ambdós amb els dominis de temps i valor ja vistos com per exemple el tipus de dades 'reals estesos'. Inclou algunes restriccions més que les relacions:

* Els temps no poden estar repetits: (key restriction {t})

* Els valors han de contenir el mateix tipus d'objecte.

Els temps no repetits indueixen un ordre temporal a les sèries temporals. Tot i així, les relacions, per ser conjunts, conserven la no definció d'un ordre dels elements. 


En el model relacional no hi ha ordre en els atributs a diferència de les relacions matemàtiques que tenen un ordre d'esquerra a dreta \parencite[sec.\ 5.3]{date:introduction}.

\subsection{Exemples}

\pgfplotsset{
    timeseriesrel/.style={
        height=4cm,
        axis x line=middle,
        axis y line=middle,
        enlarge x limits=0.2,
        enlarge y limits=0.2,
        xlabel=t,
        ylabel=v,
        xlabel style={ at={(current axis.right of origin)},anchor=mid west},
        ylabel style={ at={(current axis.above origin)},anchor=south},
        title style={at={(current axis.left of origin)},anchor=north east},
    }
}




\paragraph{Exemple 1} \emph{Valors reals}.
Sèrie temporal $S_1$ on el temps i els valors pertanyen a $\bar{\mathbb{R}}$. Conté la mesura de valor 1 en el temps 5, la mesura de valor 3 en el temps 7 i la mesura de valor 1 en el temps 10. Modelada com a relació, és a dir com a parella capçalera i conjunt de valors certs, s'escriu com 
$S_1 = ( \{temps: \bar{\mathbb{R}}, valor: \bar{\mathbb{R}}\}, \{ \{temps:5,valor:1\}, \{temps:7,valor:3\}, \{temps:10,valor:1\} \} )$.

Degut al format esquemàtic, simplifiquem l'escriptura de les sèries temporals com a conjunt de tuples $(t,v)$ a on $t$ és el temps i $v$ és el valor. Així doncs la sèrie temporal $S$ es pot escriure de manera simplificada com a 
$S = \{ (5,1), (7,3), (10,1) \}$.

Tal com s'utilitza en les relacions, les sèries temporals es poden visualitzar com a taules. La sèrie temporal $S_1$ es visualitza com a taula a la \autoref{fig:model:serietemporal:real}.

\begin{figure}[tp]
  \centering
  \begin{tabular}[c]{|c|c|}
    \multicolumn{2}{c}{$S_1$} \\ \hline
    $t$  & $v$ \\ \hline
    2  & 1 \\
    3  & 3 \\
    6  & 1 \\ \hline
  \end{tabular} \qquad
  \begin{tikzpicture}[baseline=(current bounding box.center)]
    \begin{axis}[
        timeseriesrel,
        title=$S_1$,
        ]
    \addplot[only marks,mark=*,blue] coordinates {
        (2,1)
        (3,3)
        (6,1)
    };
    \end{axis}
   \end{tikzpicture}
  \caption{Taula i gràfic d'una sèrie temporal amb valors reals}
  \label{fig:model:serietemporal:real}
\end{figure}


\paragraph{Exemple 2} \emph{Sèrie temporal multivaluada}.
Sèrie temporal $S_2$ on el temps pertany a $\bar{\mathbb{R}}$ i el valor pertany a  $\bar{\mathbb{R}}^3$; és a dir és un vector. Conté el valor (1,2,3) en el temps 5, el valor (3,4,5) en el temps 7 i el valor (1,2,3) en el temps 10.

De manera simplificada s'escriu com 
$S_2 = \{ (5,(1,2,3)), (7,(3,4,5)), (10,(1,2,3)) \}$ i es visualitza com a taula a la \autoref{fig:model:serietemporal:vector}. No obstant, es pot visualitzar de forma més còmode com a $S_2^b = \{ (5,1,2,3), (7,3,4,5), (10,1,2,3) \}$
\todo{citar formes normals de les relacions [Date]}

\begin{figure}[tp]
  \centering
  \begin{tabular}{|c|c|}
    \multicolumn{2}{c}{$S_2$} \\ \hline
    $t$  & $v$ \\ \hline
    5  & (1,2,3) \\
    7  & (3,4,5) \\
    10 & (1,2,3) \\ \hline
  \end{tabular} \qquad
  \begin{tabular}[tp]{|c|c|c|c|}
   \multicolumn{4}{c}{$S_2^b$} \\ \hline
    $t$  & $v_1$ & $v_2$ & $v_3$ \\ \hline
    5  & 1 & 2 & 3 \\
    7  & 3 & 4 & 5 \\
    10 & 1 & 2 & 3 \\ \hline
  \end{tabular}

  \caption{Taula d'una sèrie temporal amb valors vectors}
  \label{fig:model:serietemporal:vector}
\end{figure}


\paragraph{Exemple 3} \emph{Valors relació}. \label{par:model:exemple-relvalues}
Sèrie temporal $S_3$ on el temps pertany a $\bar{\mathbb{R}}$ i el valor és una sèrie temporal del mateix format que en l'exemple 1. Conté les tuples de $S_1$ com a valors en el temps 1 i 2. 

De manera simplificada s'escriu com
$S_3 =  \{ (1,\{ (5,1), (7,3), (10,1) \}), 
(2,\{ (5,1),$ $(7,3),$ $(10,1) \}) \}$
i es visualitza com a taula a la \autoref{fig:model:serietemporal:serietemporal}.


\begin{figure}[tp]
  \centering
  \begin{tabular}{|c|c|}
    \multicolumn{2}{c}{$S_3$} \\ \hline
    $t$  & $v$ \\ \hline
    1 &   
       \begin{tabular}{|c|c|}
         \hline
         $t$  & $v$ \\ \hline
         5  & 1 \\
         7  & 3 \\
         10 & 1 \\ \hline
       \end{tabular} \\ \hline
    2 & 
       \begin{tabular}{|c|c|}
         \hline
         $t$  & $v$ \\ \hline
         5  & 1 \\
         7  & 3 \\
         10 & 1 \\ \hline
       \end{tabular} \\ \hline
  \end{tabular}
  \caption{Taula d'una sèrie temporal amb valors sèrie temporal}
  \label{fig:model:serietemporal:serietemporal}
\end{figure}


S'observa que la capçalera de $S3$ és $\{temps:\bar{\mathbb{R}},valor:
relacio\{temps:\bar{\mathbb{R}},valor:\bar{\mathbb{R}}\}\}$ \parencite[sec.\ 5.3]{date:introduction}. És a dir, el valor és de tipus relació que es defineix amb la capçalera de la relació on el temps i el valor pertanyen a $\bar{\mathbb{R}}$. Per tant, el valor de $S3$ és de tipus sèrie temporal amb valors reals. Cal insistir que \emph{tots} el valors de $S3$ han de pertànyer al mateix domini \parencite[sec.\ 5.4]{date:introduction}, el qual és $relacio\{temps:\bar{\mathbb{R}},valor:\bar{\mathbb{R}}\}$.


\todo{S'ha de mirar a [Date] com es treballen les formes normals amb
  restriccions} En aquesta relació no es pot aplicar el mateix que a
l'exemple 2 de formes normals ja que hi ha una restricció de $S_3\{t\}$
única i cada subsèrie també la té.  Així doncs no seria correcte
desplegar-la $S^b_3 = \{ (1,5,1), (1,7,3), (1,10,1), (2,5,1),
(2,7,3),(2,10,1)\}$ ja que no es compleix la unicitat de $S^b_3 \{t\}$; en tot cas s'hauria de canviar la restricció a $S^b_3 \{t^1,t^2\}$








\paragraph{Exemple 4} \emph{Valors caràcters}.
Sèrie temporal $S_4$ on el temps pertany a $\bar{\mathbb{R}}$ i els valors són caràcters que pertanyen a $C=\{a,b,\dotsc,z,\infty\}$. $S_4 = \{ (2,a), (3,c), (6,a) \}$.

La sèrie temporal $S_4$ es visualitza com a taula a la \autoref{fig:model:serietemporal:caracter}.

\begin{figure}[tp]
  \centering
  \begin{tabular}[c]{|c|c|}
    \multicolumn{2}{c}{$S_4$} \\ \hline
    $t$  & $v$ \\ \hline
    2  & a \\
    3  & c \\
    6  & a \\ \hline
  \end{tabular} \qquad
  \begin{tikzpicture}[baseline=(current bounding box.center)]
    \begin{axis}[
        timeseriesrel,
        title=$S_4$,
        yticklabels={0,0,a,b,c},
        ]
    \addplot[only marks,mark=*,blue] coordinates {
        (2,1)
        (3,3)
        (6,1)
    };
    \end{axis}
   \end{tikzpicture}
  \caption{Taula i gràfic d'una sèrie temporal amb valors caràcters}
  \label{fig:model:serietemporal:caracter}
\end{figure}





\paragraph{Exemple retirar} \emph{Variable relació}.\todo{això no es pot fer, perquè no existeix el tipus relvar?? però les tuples poden contenir expressions?? No existeixen les tuplevar (Date rebutja ferotjament els apuntadors a dins dels DBMS) [Date on database :writings 2000-2006 / C.J. Date]}
Sèrie temporal $S_4$ on el temps pertany a $\bar{\mathbb{R}}$ i el valor és una referència a una sèrie temporal. Conté $S_1$ com a valors en el temps 1 i 2. 

De manera simplificada s'escriu com
$S_4 =  \{ (1,S_1) , (2,S_1) \}$ 
i es visualitza com a taula a la \autoref{fig:model:serietemporal:relvar}.

S'aplica el concepte de variable relació (\emph{relvar}) dels SGBDR \parencite[sec.\ 3.3]{date:introduction}.
Així doncs, cal notar que $S_4$  no és el mateix que $S_3$.
\begin{figure}[tp]
  \centering
  \begin{tabular}{|c|c|}
    \multicolumn{2}{c}{$S_4$} \\ \hline
    $t$  & $v$ \\ \hline
    1 & $S_1$ \\
    2 & $S_1$ \\ \hline
  \end{tabular}
  \caption{Taula d'una sèrie temporal amb valors \emph{relvar}}
  \label{fig:model:serietemporal:relvar}
\end{figure}


Relació de noms i sèries temporals $R =  ((nom:string,serie:relacio\{temps:\bar{\mathbb{R}},valor:\bar{\mathbb{R}}),\{ ('S_1',S_1),('S_2',S_2)  \})$

Sèrie temporal amb strings com a valors:
$N= ( (temps:\bar{\mathbb{R}},valor:string) ,\{ (1,'S_1') , (2,'S_1') \})$

Sèrie temporal com a variable relació de vista (relvar view)
$S_4 =  (N RENAME valor as nom) JOIN R$
\todo{cal definir una view}












%%% Local Variables:
%%% TeX-master: "main"
%%% End:







% LocalWords:  SGST
