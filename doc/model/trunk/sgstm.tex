\chapter{Model SGSTM}
\label{cap:model:sgstm}


\todo{Proposta de noms}
\begin{itemize}
\item Buffer
\item Disc
\item Subsèrie temporal resolució-atribut
\item Sèrie temporal multiresolució
\item Base de dades de sèries temporals multiresolució
\end{itemize}



En aquest capítol es defineix un model dels sistemes de gestió de
bases de dades per a sèries temporals multiresolució (SGSTM). Aquest
model s'estructura un objecte principal que són les sèries temporals
multiresolució, les quals són conjunts de subsèries temporals
resolució formades per discs i buffers. El model es dissenya en dues
parts.

\begin{itemize}
\item Primer, es defineix el model d'estructura de les dades, és a
  dir, la forma que prenen els buffers, els discs, les subsèries
  resolució, les sèries temporals multiresolució i les bases de dades
  de sèries temporals multiresolució.
\item Segon, es defineix el model d'operacions sobre les dades, és a
  dir, els operadors bàsics que permeten modelar el comportament i la
  manipulació de bases de dades multiresolució.
\end{itemize}





\section{Model estructural de dades}

Una base de dades de sèries temporals multiresolució (BDSTM) és un
conjunt de sèries temporals multiresolució a on cada una és una
relació de buffers amb discs.

\todo{descriure l'arquitectura}
\begin{figure}[tp]
\centering
\input{imatges/model/mtsms-arquitectura_interna.tex}
\caption{Arquitectura del model SGSTM}
\label{fig:model:bdstm}
\end{figure}


Aquí només es defineixen els conceptes referents a l'estructura del
model. Aquesta estructura, però, requereix uns operadors específics
per a emmagatzemar-hi les mesures, els quals es defineixen a
l'apartat~\ref{sec:model:sgstm-estructurals}.




\subsection{Buffer}\label{sec:model:buffer}\todo{falta parlar de regularitat de ST}\todo{falta parlar de representació de ST}

Un buffer és un contenidor d'una sèrie temporal, regular o no regular, que mitjançant una funció permet regularitzar aquesta sèrie temporal amb un període de mostreig constant. A l'acció de regularitzar un interval d'una sèrie temporal l'anomenarem consolidació, al període de mostreig contant l'anomenarem pas de consolidació i a la funció de regularització l'anomenarem agregador d'atributs.

\begin{definition}[Buffer]
  Definim \emph{buffer} com el tuple $(S,\tau,\delta,f)$, en el que
  $S$ és una sèrie temporal, $\tau$ és el darrer instant de temps de
  consolidació, $\delta$ és la durada del pas de consolidació i $f$ és
  un agregador d'atributs.
\end{definition}

La consolidació d'una sèrie temporal s'inicia en un instant de temps
concret i té lloc a cada pas de consolidació. Amb la finalitat
d'establir els intervals de consolidació de la sèrie temporal, es
defineix un buffer inicial.

\begin{definition}\label{def:model:buffer_buit}
  Definim buffer inicial o buffer buit com el buffer $B_{\emptyset} =
  (\emptyset,t_0, \delta_0, f)$, el qual
  conté una sèrie temporal buida, l'instant de temps inicial de
  consolidació, una durada que indica el pas de consolidació i un
  agregador d'atributs.
\end{definition}

A partir del buffer buit es poden conèixer tots els instants de temps
de consolidació del buffer, els quals seran $t_0+k\delta,
k\in\mathbb{N}$. Aquests instants de temps de consolidació també
defineixen els intervals de temps de consolidació del buffer de la
forma $i=[\tau,\tau+\delta]$. La consolidació de la sèrie temporal $S$
d'un buffer en un interval de temps $i$ dóna com a resultat una
mesura $m=(t,v)$ calculada a partir de l'agregador d'atributs $m = f
(S, i)$.








\subsection{Disc}\label{sec:model:disc}

Un disc és un contenidor d'una sèrie temporal regular amb un nombre
acotat de mesures. En arribar al nombre màxim de mesures permeses,
cada cop que s'afegeix una mesura nova s'elimina la mesura mínima de
la sèrie temporal.  Així doncs, un disc és semblant a una cua
\emph{First In First Out} (FIFO), a on el primer d'arribar és el
primer de sortir.

\begin{definition}[Disc]
  Definim \emph{disc} com el tuple $(S,k)$, en el que $S$
  és una sèrie temporal i $k\in\mathbb{N}$ és el cardinal màxim de $S$.
\end{definition}

A l'inici, un disc no conté mesures però cal que estigui caracteritzat
pel cardinal màxim. Amb aquesta finalitat es defineix un disc inicial.

\begin{definition}\label{def:model:disc_buit}
  Definim disc inicial o disc buit com el disc $D_{\emptyset} =
  (\emptyset,k)$, el qual conté una sèrie temporal buida i el cardinal
  màxim que podrà prendre $S$.
\end{definition}




\subsection{Subsèrie resolució}\label{sec:model:subserie-resolucio}

Una subsèrie temporal resolució és una parella de disc i buffer. En el
buffer hi ha la part d'una sèrie temporal a regularitzar i en el disc
hi ha l'altra part ja regularitzada, amb un nombre acotat de
mesures. A l'acció de regularitzar l'anomenem consolidar en coherència
amb el concepte descrit pels buffers.


\begin{definition}[Subsèrie resolució]
  Definim \emph{subsèrie resolució} com el tuple $(B,D)$, en el que
  $B$ és un buffer i $D$ és un disc.
\end{definition}
 
La definició de buffer buit (def.~\ref{def:model:buffer_buit}) i de
disc buit (def.~\ref{def:model:disc_buit}) indueixen a una definició
de subsèrie resolució buida.
\begin{definition}\label{def:model:subserie_resolucio_buida}
  Definim subsèrie resolució buida com la subsèrie resolució $R_{\emptyset}
  = (B_{\emptyset},D_{\emptyset})$, la qual conté un buffer buit i un
  disc buit.
\end{definition}


Les subsèries resolució es consoliden seguint els criteris del seu
buffer i emmagatzemant la mesura de consolidació al seu disc.




\subsection{Sèrie temporal multiresolució}

Una sèrie temporal multiresolució és un conjunt de subsèries resolució que
comparteixen l'entrada de mesures, les quals provenen d'una mateixa
sèrie temporal. La sèrie temporal queda regularitzada i distribuïda en
les diferents subsèries resolució amb resolucions diferents, tal com s'ha
vist a la \autoref{fig:model:bdstm}


\begin{definition}[Sèrie temporal multiresolució]
  Definim \emph{sèrie temporal multiresolució} com el conjunt de subsèries
  resolució $M=\{R_0,\dotsc,R_d\}$.
\end{definition}

A partir de la definició de subsèrie resolució buida
(def.~\ref{def:model:subserie_resolucio_buida}) és defineix la sèrie
temporal multiresolució buida.
 
\begin{definition}\label{def:model:st_multiresolucio_buit}
  Definim sèrie temporal multiresolució buida com el conjunt de subsèries
  resolució buides
  $M_{\emptyset}=\{R_{0_{\emptyset}},\dotsc,R_{d_{\emptyset}\}}$.
\end{definition}

Normalment, en una sèrie temporal multiresolució no hi ha dues subsèries
resolució amb la mateixa informació. És a dir, donats dues subsèries
resolució $R_a = (B_a, D_a)$ i $R_b = (B_b, D_b)$, els seus respectius
buffers $B_a=(S_a,\tau_a,\delta_a,f_a)$ i
$B_b=(S_b,\tau_b,\delta_b,f_b)$ no tenen el mateix interval de
consolidació i agregador d'atributs: $\delta_a \neq \delta_b \wedge
f_a \neq f_b$.




\subsection{Base de dades de sèries temporals
  multiresolució}\label{sec:model:bdstm}

Una base de dades de sèries temporals multiresolució (BDSTM) és un
conjunt de sèries temporal multiresolució.

Les sèries temporals es poden emmagatzemar exclusivament en una BDSTM
o poden conviure amb altres tipus de dades en bases de dades que tinguin
capacitats de BDSTM.



\subsection{Relació sèrie temporal multiresolució}



Una sèrie temporal multiresolució és una relació de buffers i discs. A
cada parella buffer-disc l'anomenem disc resolució. Així doncs, una
sèrie temporal multiresolució és un conjunt de discs resolució.

Com a conjunt de discs resolució, una sèrie temporal multiresolució
s'observa com una relació de grau sis a on la capçalera conté els
atributs
\begin{itemize}
\item sèrie temporal del buffer ($S_B$),
\item sèrie temporal del disc ($S_D$),
\item últim instant de consolidació ($\tau$),
\item pas de consolidació ($\delta$),
\item màxim cardinal del disc ($k$),
\item i funció d'agregació d'atributs ($f$).
\end{itemize}

Una restricció habitual és que $\delta$ i $f$ no estiguin repetits; és
a dir que són els atributs clau de la relació sèrie temporal multiresolució.





\subsection{Exemples}

\paragraph{Exemple 1} \emph{Sèrie temporal multiresolució}

Una sèrie temporal multiresolució fotografiada en un instant de temps que podria
ser entre el 27 i el 30.


%S'observa que per tal de complir amb les propietats de les relacions, totes les sèries temporals dels buffers han de ser del mateix tipus, és a dir tenir la mateixa capçalera. El mateix succeeix amb les sèries temporals dels discs. (Vegeu els exemples de la secció \ref{par:model:exemple-relvalues} sobre valors relació).

\begin{figure}[tp]
  \centering
  \begin{tabular}{|c|c|c|c|c|c|}
    \multicolumn{2}{c}{$M_1$} \\ \hline
    $S_B$  & $S_D$ & $\tau$ & $\delta$ & $k$ & $f$ \\ \hline
      \begin{tabular}{|c|c|}
         \hline
         $t$  & $v$ \\ \hline
         26  & 0 \\
         27 & 0 \\\hline
       \end{tabular} & 
      \begin{tabular}{|c|c|}
         \hline
         $t$  & $v$ \\ \hline
         10  & 0 \\
         15  & 0 \\
         20 & 0 \\ 
         25 & 0 \\\hline
       \end{tabular} 
       & 25 & 5  & 4 & mitjana  \\ \hline
       \begin{tabular}{|c|c|}
         \hline
         $t$  & $v$ \\ \hline
         22  & 0 \\
         26  & 0 \\
         27 & 0 \\\hline
       \end{tabular} & 
      \begin{tabular}{|c|c|}
         \hline
         $t$  & $v$ \\ \hline
         10  & 0 \\
         20  & 0 \\\hline
       \end{tabular}  
       & 20 & 10 & 2 & mitjana  \\ \hline
  \end{tabular}
  \caption{Taula d'una sèrie temporal multiresolució}
  \label{fig:model:stm}
\end{figure}




\paragraph{Exemple 2} \emph{Sèrie temporal multiresolució amb vistes}

És el mateix que la sèrie temporal multiresolució de l'exemple 1 però
organitzat de forma més còmode amb vistes relacionals.



\begin{figure}[tp]
  \centering
  \begin{tabular}{|c|c|c|c|c|c|}
    \multicolumn{2}{c}{$M'_2$} \\ \hline
    $S'_B$  & $S'_D$ & $\tau$ & $\delta$ & $k$ & $f$ \\ \hline
    $S_{B1}$ & $S_{D1}$ & 45 & 5  & 2 & mitjana  \\
    $S_{B2}$ & $S_{D2}$ & 40 & 10 & 4 & mitjana  \\ \hline
  \end{tabular}\qquad
  \begin{tabular}{|c|c|c|}
    \multicolumn{3}{c}{$M^{\text{series}}_{2}$} \\ \hline
    \multirow{2}{*}{$S'$}  &  \multicolumn{2}{c|}{$S$} \\ \cline{2-3}
    & $t$      & $v$  \\ \hline
    \multirow{2}{*}{$S_{B1}$} 
    & 26 & 0 \\ 
    & 27 & 0 \\ \hline
    \multirow{3}{*}{$S_{B2}$} 
    & 22 & 0 \\ 
    & 26 & 0 \\ 
    & 27 & 0 \\ \hline
    \multirow{4}{*}{$S_{D1}$} 
    & 10 & 0 \\ 
    & 15 & 0 \\ 
    & 20 & 0 \\ 
    & 25 & 0 \\ \hline
    \multirow{2}{*}{$S_{D2}$} 
    & 10 & 0 \\ 
    & 20 & 0 \\ \hline
  \end{tabular}
  \caption{Taula d'una sèrie temporal multiresolució amb vistes}
  \label{fig:model:stm:vistes}
\end{figure}




%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "main"
%%% End: 

% LocalWords:  buffers multiresolució agregador l'agregador
